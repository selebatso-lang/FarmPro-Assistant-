  
  button.small {
    padding: 0.5rem 1rem;
    font-size: 0.85rem;
  }
  
  .btn-outline {
    background: white;
    color: var(--primary);
    border: 2px solid var(--primary);
  }
  
  .btn-outline:hover {
    background: var(--primary);
    color: white;
  }
  
  .btn-harvest {
    background: linear-gradient(135deg, var(--harvest) 0%, var(--sun) 100%);
    color: white;
  }
  
  .btn-harvest:hover {
    box-shadow: 0 4px 12px rgba(255, 183, 77, 0.3);
  }
  
  ul {
    padding-left: 1.2rem;
    margin: 0.5rem 0;
  }
  
  .row {
    display: flex;
    gap: 0.8rem;
  }
  
  .col {
    flex: 1;
  }
  
  .progress-bar {
    background: #e0e0e0;
    border-radius: 10px;
    overflow: hidden;
    height: 20px;
    margin-top: 0.5rem;
  }
  
  .progress-fill-bar {
    height: 100%;
    background: linear-gradient(90deg, var(--primary) 0%, var(--growth) 100%);
    color: white;
    text-align: center;
    line-height: 20px;
    font-size: 0.8rem;
    font-weight: 600;
    transition: width 0.5s ease;
  }
  
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 0.8rem;
    font-size: 0.9rem;
  }
  
  th, td {
    border: 1px solid #e0e0e0;
    padding: 0.6rem;
    text-align: left;
  }
  
  th {
    background: var(--primary);
    color: white;
    font-weight: 600;
  }
  
  .muted {
    color: var(--muted);
    font-size: 0.9rem;
  }
  
  .trial-section {
    background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%);
    border-left: 5px solid var(--warning);
  }
  
  .activation-section {
    background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%);
    border-left: 5px solid var(--primary);
  }
  
  .readonly-mode {
    background: #f5f5f5;
    pointer-events: none;
    opacity: 0.7;
  }
  
  .countdown-timer {
    font-weight: bold;
    color: var(--danger);
    text-align: center;
    padding: 0.8rem;
    background: #f8d7da;
    border-radius: 8px;
    margin: 0.8rem 0;
    font-size: 1.1rem;
  }
  
  .gps-status {
    margin: 1rem 0;
    padding: 1rem;
    border-radius: 8px;
    background: var(--light);
    border: 2px dashed #ddd;
  }
  
  .gps-instructions {
    background: #e3f2fd;
    padding: 1rem;
    border-radius: 8px;
    margin: 1rem 0;
    border-left: 4px solid var(--info);
  }
  
  .quick-actions {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 0.8rem;
    margin: 1rem 0;
  }
  
  .quick-action-btn {
    background: white;
    border: 2px solid #e0e0e0;
    border-radius: 10px;
    padding: 1rem;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 600;
  }
  
  .quick-action-btn:hover {
    border-color: var(--primary);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    background: linear-gradient(135deg, #f1f8e9 0%, #dcedc8 100%);
  }
  
  .action-icon {
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
    color: var(--primary);
  }
  
  footer {
    background: var(--dark);
    color: white;
    text-align: center;
    padding: 1.5rem;
    margin-top: 2rem;
  }
  
  .contact-info {
    font-size: 1.1rem;
    margin-bottom: 0.5rem;
  }
  
  .support-text {
    font-size: 0.9rem;
    opacity: 0.8;
  }
  
  .activation-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 1000;
    justify-content: center;
    align-items: center;
  }
  
  .activation-content {
    background: white;
    padding: 2rem;
    border-radius: 15px;
    max-width: 500px;
    width: 90%;
    text-align: center;
  }
  
  /* POS Styles */
  .pos-grid {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 1.5rem;
    margin-top: 1rem;
  }
  
  .pos-items {
    background: #f8f9fa;
    padding: 1rem;
    border-radius: 8px;
    max-height: 400px;
    overflow-y: auto;
  }
  
  .pos-cart {
    background: #f8f9fa;
    padding: 1rem;
    border-radius: 8px;
  }
  
  .pos-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.8rem;
    border-bottom: 1px solid #e0e0e0;
    cursor: pointer;
  }
  
  .pos-item:hover {
    background: #e8f5e9;
  }
  
  .pos-item.selected {
    background: #e3f2fd;
    border-left: 4px solid var(--info);
  }
  
  .cart-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.8rem;
    border-bottom: 1px solid #e0e0e0;
  }
  
  .cart-total {
    background: var(--primary);
    color: white;
    padding: 1rem;
    border-radius: 8px;
    margin-top: 1rem;
    text-align: center;
    font-size: 1.2rem;
    font-weight: bold;
  }
  
  .quantity-controls {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  
  .quantity-btn {
    width: 30px;
    height: 30px;
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  /* Inventory Styles */
  .inventory-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
  }
  
  .inventory-item {
    background: #f8f9fa;
    padding: 1rem;
    border-radius: 8px;
    border-left: 4px solid var(--primary);
  }
  
  .inventory-item.low-stock {
    border-left-color: var(--warning);
    background: #fff3cd;
  }
  
  .inventory-item.out-of-stock {
    border-left-color: var(--danger);
    background: #f8d7da;
  }
  
  /* Finance Styles */
  .finance-summary {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 1.5rem;
  }
  
  .finance-card {
    background: white;
    padding: 1rem;
    border-radius: 8px;
    text-align: center;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  
  .finance-card.income {
    border-top: 4px solid var(--primary);
  }
  
  .finance-card.expense {
    border-top: 4px solid var(--danger);
  }
  
  .finance-card.balance {
    border-top: 4px solid var(--info);
  }
  
  .transaction-list {
    max-height: 400px;
    overflow-y: auto;
    margin-top: 1rem;
  }
  
  .transaction-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.8rem;
    border-bottom: 1px solid #e0e0e0;
  }
  
  .transaction-item.income {
    border-left: 4px solid var(--primary);
  }
  
  .transaction-item.expense {
    border-left: 4px solid var(--danger);
  }
  
  /* Crop Guide Styles */
  .crop-details {
    display: none;
    margin-top: 1.5rem;
    padding: 1.5rem;
    background: #f8f9fa;
    border-radius: 8px;
    border-left: 4px solid var(--primary);
  }
  
  .detail-section {
    margin-bottom: 1.5rem;
  }
  
  .detail-section h4 {
    color: var(--primary);
    margin-bottom: 0.5rem;
    padding-bottom: 0.3rem;
    border-bottom: 1px solid #e0e0e0;
  }
  
  .care-stage {
    background: white;
    padding: 1rem;
    border-radius: 8px;
    margin-bottom: 1rem;
    border-left: 4px solid var(--growth);
  }
  
  /* My Crops Styles */
  .crop-progress {
    margin: 1rem 0;
  }
  
  .planted-crop-card {
    background: white;
    border-radius: 10px;
    padding: 1.2rem;
    margin-bottom: 1rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    border-left: 4px solid var(--primary);
  }
  
  .crop-status {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 0.5rem;
  }
  
  /* Tasks Styles */
  .task-card {
    background: white;
    border-radius: 10px;
    padding: 1.2rem;
    margin-bottom: 1rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    border-left: 4px solid var(--info);
  }
  
  .task-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
  }
  
  /* Clients Styles */
  .client-card {
    background: white;
    border-radius: 10px;
    padding: 1.2rem;
    margin-bottom: 1rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    border-left: 4px solid var(--harvest);
  }
  
  .client-actions {
    display: flex;
    gap: 0.5rem;
    margin-top: 0.8rem;
  }
  
  /* Reports Styles */
  .report-options {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin: 1.5rem 0;
  }
  
  .report-card {
    background: white;
    border-radius: 10px;
    padding: 1.5rem;
    text-align: center;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    cursor: pointer;
    transition: all 0.3s ease;
    border: 2px solid transparent;
  }
  
  .report-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    border-color: var(--primary);
  }
  
  .report-content {
    display: none;
    margin-top: 1.5rem;
    padding: 1.5rem;
    background: #f8f9fa;
    border-radius: 8px;
  }
  
  .print-btn {
    background: var(--harvest);
    margin-top: 1rem;
  }
  
  .export-btn {
    background: var(--info);
    margin-top: 1rem;
  }
  
  @media (max-width: 768px) {
    .dashboard-grid {
      grid-template-columns: 1fr;
    }
    
    .row {
      flex-direction: column;
    }
    
    header {
      font-size: 1.2rem;
      padding: 1rem;
    }
    
    main {
      padding: 0.8rem;
    }
    
    .pos-grid {
      grid-template-columns: 1fr;
    }
    
    .report-options {
      grid-template-columns: 1fr;
    }
    
    .inventory-grid {
      grid-template-columns: 1fr;
    }
    
    .finance-summary {
      grid-template-columns: 1fr;
    }
    /* ============================================= */
/* ENHANCED GPS SECTION STYLES */
/* ============================================= */

.gps-section {
    background: linear-gradient(135deg, #2e7d32 0%, #388e3c 50%, #4caf50 100%);
    border-radius: 15px;
    padding: 2rem;
    margin: 1rem 0;
    position: relative;
    overflow: hidden;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

.gps-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23ffffff' fill-opacity='0.1' fill-rule='evenodd'/%3E%3C/svg%3E");
    opacity: 0.3;
}

.farm-profile-card {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 12px;
    padding: 2rem;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    text-align: center;
}

.farm-header {
    margin-bottom: 1.5rem;
}

.farm-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
    color: #388e3c;
}

.farm-name-display {
    font-size: 1.8rem;
    font-weight: bold;
    color: #2e7d32;
    margin-bottom: 0.5rem;
}

.farm-coordinates {
    font-size: 1.1rem;
    color: #666;
    margin-bottom: 1.5rem;
    font-family: 'Courier New', monospace;
    background: #f8f9fa;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    display: inline-block;
}

.farm-actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
    margin-bottom: 1.5rem;
}

.farm-action-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
}

.farm-action-btn.primary {
    background: #388e3c;
    color: white;
}

.farm-action-btn.secondary {
    background: #f8f9fa;
    color: #388e3c;
    border: 2px solid #388e3c;
}

.farm-action-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.farm-action-btn.primary:hover {
    background: #2e7d32;
}

.farm-action-btn.secondary:hover {
    background: #e8f5e8;
}

.farm-name-form {
    background: rgba(248, 249, 250, 0.8);
    padding: 1.5rem;
    border-radius: 8px;
    margin-top: 1.5rem;
}

.farm-name-input-group {
    display: flex;
    gap: 0.5rem;
    max-width: 400px;
    margin: 0 auto;
}

.farm-name-input {
    flex: 1;
    padding: 0.75rem;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 1rem;
    transition: border-color 0.3s ease;
}

.farm-name-input:focus {
    outline: none;
    border-color: #388e3c;
}

.save-farm-btn {
    background: #ff9800;
    color: white;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.3s ease;
}

.save-farm-btn:hover {
    background: #f57c00;
}

/* Trial Status Styles */
.trial-status-card {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 12px;
    padding: 2rem;
    text-align: center;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    margin-bottom: 1rem;
}

.trial-timer {
    font-size: 1.5rem;
    font-weight: bold;
    color: #ff9800;
    margin: 1rem 0;
}

.activation-section {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 12px;
    padding: 2rem;
    text-align: center;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

.gps-controls {
    text-align: center;
    margin-top: 1rem;
}

.gps-status {
    margin-top: 1rem;
    color: white;
}

.gps-status div {
    margin: 0.5rem 0;
}

/* Responsive Design */
@media (max-width: 768px) {
    .gps-section {
        padding: 1rem;
    }
    
    .farm-actions {
        flex-direction: column;
    }
    
    .farm-name-input-group {
        flex-direction: column;
    }
    
    .farm-action-btn {
        width: 100%;
        justify-content: center;
    }
    
    .farm-profile-card {
        padding: 1.5rem;
    }
    /* ============================================= */
/* ENHANCED CROP GUIDE STYLES */
/* ============================================= */

.crop-guide-container {
    display: grid;
    grid-template-columns: 300px 1fr;
    gap: 2rem;
    margin-top: 1rem;
}

/* Crop Filter Sidebar */
.crop-filter-sidebar {
    background: #f8f9fa;
    padding: 1.5rem;
    border-radius: 12px;
    height: fit-content;
    position: sticky;
    top: 2rem;
}

.filter-section {
    margin-bottom: 1.5rem;
}

.filter-section h4 {
    margin-bottom: 0.5rem;
    color: #2e7d32;
    font-size: 1rem;
}

.filter-options {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.filter-option {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem;
    border-radius: 6px;
    cursor: pointer;
    transition: background 0.3s ease;
}

.filter-option:hover {
    background: #e8f5e8;
}

.filter-option.active {
    background: #388e3c;
    color: white;
}

/* Crop Grid */
.crop-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1.5rem;
}

.crop-card {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    cursor: pointer;
    border: 2px solid transparent;
}

.crop-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
    border-color: #388e3c;
}

.crop-card-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1rem;
}

.crop-icon {
    font-size: 2rem;
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #e8f5e8;
    border-radius: 10px;
}

.crop-basic-info h3 {
    margin: 0;
    color: #2e7d32;
    font-size: 1.2rem;
}

.crop-type {
    background: #388e3c;
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
}

.crop-quick-stats {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0.75rem;
    margin-bottom: 1rem;
}

.stat-item {
    text-align: center;
    padding: 0.5rem;
    background: #f8f9fa;
    border-radius: 8px;
}

.stat-value {
    font-weight: bold;
    color: #2e7d32;
    font-size: 0.9rem;
}

.stat-label {
    font-size: 0.75rem;
    color: #666;
    margin-top: 0.25rem;
}

.crop-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: 1rem;
}

.crop-tag {
    background: #e3f2fd;
    color: #1976d2;
    padding: 0.25rem 0.5rem;
    border-radius: 12px;
    font-size: 0.7rem;
    font-weight: 600;
}

.crop-tag.water-low { background: #e8f5e8; color: #388e3c; }
.crop-tag.water-medium { background: #fff3e0; color: #f57c00; }
.crop-tag.water-high { background: #ffebee; color: #d32f2f; }

.view-details-btn {
    width: 100%;
    padding: 0.75rem;
    background: #388e3c;
    color: white;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.3s ease;
}

.view-details-btn:hover {
    background: #2e7d32;
}

/* Enhanced Crop Details */
.enhanced-crop-details {
    background: white;
    border-radius: 12px;
    padding: 2rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.details-header {
    display: flex;
    align-items: center;
    gap: 1.5rem;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid #f0f0f0;
}

.details-icon {
    font-size: 3rem;
    width: 80px;
    height: 80px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #e8f5e8;
    border-radius: 15px;
}

.details-title h2 {
    margin: 0;
    color: #2e7d32;
    font-size: 1.8rem;
}

.details-subtitle {
    color: #666;
    font-size: 1.1rem;
}

.details-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.detail-card {
    background: #f8f9fa;
    padding: 1.5rem;
    border-radius: 10px;
    border-left: 4px solid #388e3c;
}

.detail-card h4 {
    margin: 0 0 1rem 0;
    color: #2e7d32;
    font-size: 1.1rem;
}

.pest-disease-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.pest-disease-list li {
    padding: 0.5rem 0;
    border-bottom: 1px solid #e0e0e0;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.pest-disease-list li:last-child {
    border-bottom: none;
}

.care-timeline {
    margin-top: 2rem;
}

.timeline-item {
    display: flex;
    gap: 1rem;
    padding: 1.5rem;
    border-left: 3px solid #388e3c;
    background: #f8f9fa;
    margin-bottom: 1rem;
    border-radius: 0 8px 8px 0;
}

.timeline-duration {
    background: #388e3c;
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
    white-space: nowrap;
}

.timeline-content h5 {
    margin: 0 0 0.5rem 0;
    color: #2e7d32;
    font-size: 1.1rem;
}

.timeline-tasks {
    list-style: none;
    padding: 0;
    margin: 0;
}

.timeline-tasks li {
    padding: 0.25rem 0;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.timeline-tasks li:before {
    content: "‚úì";
    color: #388e3c;
    font-weight: bold;
}

/* Seasonal Planning */
.seasonal-planning {
    background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
    padding: 2rem;
    border-radius: 12px;
    margin-top: 2rem;
}

.seasonal-planning h3 {
    color: #1976d2;
    margin-bottom: 1rem;
}

.season-calendar {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
    margin-top: 1rem;
}

.season-month {
    text-align: center;
    padding: 1rem;
    background: white;
    border-radius: 8px;
    border: 2px solid transparent;
}

.season-month.active {
    border-color: #388e3c;
    background: #e8f5e8;
}

.month-name {
    font-weight: bold;
    margin-bottom: 0.5rem;
}

.season-indicator {
    font-size: 0.8rem;
    padding: 0.25rem 0.5rem;
    border-radius: 12px;
    background: #388e3c;
    color: white;
}

/* Responsive Design */
@media (max-width: 1024px) {
    .crop-guide-container {
        grid-template-columns: 1fr;
    }
    
    .crop-filter-sidebar {
        position: static;
    }
}

@media (max-width: 768px) {
    .crop-grid {
        grid-template-columns: 1fr;
    }
    
    .details-grid {
        grid-template-columns: 1fr;
    }
    
    .season-calendar {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .details-header {
        flex-direction: column;
        text-align: center;
    }
    /* ============================================= */
/* SVG ICON SYSTEM - UNIVERSAL COMPATIBILITY */
/* ============================================= */

/* Base Icon Styles */
.icon {
    display: inline-block;
    width: 1em;
    height: 1em;
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    vertical-align: middle;
}

/* Crop Type Icons */
.icon-cereal { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23388e3c'%3E%3Cpath d='M12 2L4 7v10l8 5 8-5V7l-8-5zm-1 15.5v-5l6-3.5v5l-6 3.5z'/%3E%3C/svg%3E"); }
.icon-oilseed { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23ff9800'%3E%3Ccircle cx='12' cy='12' r='10' fill='%23ffb74d'/%3E%3Ccircle cx='12' cy='12' r='6' fill='%23ff9800'/%3E%3C/svg%3E"); }
.icon-vegetable { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%234caf50'%3E%3Cpath d='M12 2L4 7v10l8 5 8-5V7l-8-5zm-1 15.5v-5l6-3.5v5l-6 3.5z'/%3E%3C/svg%3E"); }
.icon-tuber { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23795548'%3E%3Cellipse cx='12' cy='12' rx='8' ry='6'/%3E%3C/svg%3E"); }
.icon-legume { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%238d6e63'%3E%3Cpath d='M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z'/%3E%3C/svg%3E"); }
.icon-fruit { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23e91e63'%3E%3Ccircle cx='12' cy='12' r='10' fill='%23f48fb1'/%3E%3Ccircle cx='9' cy='9' r='2' fill='%23e91e63'/%3E%3C/svg%3E"); }

/* Specific Crop Icons */
.icon-maize { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23ffeb3b'%3E%3Cpath d='M12 2L4 7v10l8 5 8-5V7l-8-5zm-1 15.5v-5l6-3.5v5l-6 3.5z'/%3E%3C/svg%3E"); }
.icon-tomato { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23f44336'%3E%3Ccircle cx='12' cy='12' r='10'/%3E%3C/svg%3E"); }
.icon-potato { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23795548'%3E%3Cellipse cx='12' cy='12' rx='8' ry='6'/%3E%3C/svg%3E"); }
.icon-carrot { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23ff9800'%3E%3Cpath d='M16.5 12L12 7.5 7.5 12 12 16.5z'/%3E%3Cpath d='M12 2v20'/%3E%3C/svg%3E"); }
.icon-leafy { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%234caf50'%3E%3Cpath d='M17 7l-5 5-5-5 5-5 5 5zm0 10l-5 5-5-5 5-5 5 5z'/%3E%3C/svg%3E"); }

/* Action Icons */
.icon-search { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23666'%3E%3Cpath d='M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z'/%3E%3C/svg%3E"); }
.icon-filter { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23666'%3E%3Cpath d='M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z'/%3E%3C/svg%3E"); }
.icon-calendar { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23666'%3E%3Cpath d='M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z'/%3E%3C/svg%3E"); }
.icon-water { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%232196f3'%3E%3Cpath d='M12 2l-5.5 9h11L12 2zm0 3.84L13.93 9h-3.87L12 5.84zM17.5 13c-2.49 0-4.5 2.01-4.5 4.5s2.01 4.5 4.5 4.5 4.5-2.01 4.5-4.5-2.01-4.5-4.5-4.5zm0 7a2.5 2.5 0 010-5 2.5 2.5 0 010 5z'/%3E%3C/svg%3E"); }

/* Size Variants */
.icon-small { width: 16px; height: 16px; }
.icon-medium { width: 24px; height: 24px; }
.icon-large { width: 32px; height: 32px; }
.icon-xlarge { width: 48px; height: 48px; }

/* Crop Icon Container */
.crop-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    background: #e8f5e8;
    border-radius: 10px;
    width: 50px;
    height: 50px;
}

.crop-icon .icon {
    width: 32px;
    height: 32px;
}

.details-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    background: #e8f5e8;
    border-radius: 15px;
    width: 80px;
    height: 80px;
}

.details-icon .icon {
    width: 48px;
    height: 48px;
}

/* Filter Icons */
.filter-option .icon {
    margin-right: 8px;
    width: 18px;
    height: 18px;
}

/* Header Icons */
.section-header h2 .icon {
    margin-right: 10px;
}

.filter-section h4 .icon {
    margin-right: 8px;
}

// Add CSS for mini cards (add to your CSS)
const miniCardCSS = `
    .crop-mini-card {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem;
        background: white;
        border-radius: 8px;
        cursor: pointer;
        transition: transform 0.2s ease;
        margin-bottom: 0.5rem;
    }
    
    .crop-mini-card:hover {
        transform: translateX(5px);
    }
    
    .mini-icon {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        background: #e8f5e8;
        border-radius: 8px;
    }
    
    .mini-info {
        flex: 1;
    }
    
    .mini-info strong {
        display: block;
        color: #2e7d32;
    }
    
    .mini-info div {
        font-size: 0.8rem;
        color: #666;
    }
    
    .crop-recommendations {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-top: 1rem;
    }
`;

// Inject the mini card CSS
function injectMiniCardCSS() {
    if (!document.getElementById('mini-card-css')) {
        const style = document.createElement('style');
        style.id = 'mini-card-css';
        style.textContent = miniCardCSS;
        document.head.appendChild(style);
    }
}

// Initialize when page loads
document.addEventListener('DOMContentLoaded', function() {
    injectMiniCardCSS();
});
/* ============================================= */
/* ENHANCED REPORTING SYSTEM STYLES */
/* ============================================= */

/* Report Period Selector */
.report-period-selector {
    display: flex;
    gap: 1rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
}

.period-btn {
    padding: 0.75rem 1.5rem;
    border: 2px solid #e0e0e0;
    background: white;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
}

.period-btn.active {
    background: #388e3c;
    color: white;
    border-color: #388e3c;
}

.period-btn:hover:not(.active) {
    border-color: #388e3c;
    color: #388e3c;
}

/* Date Range Selector */
.date-range-selector {
    background: #f8f9fa;
    padding: 1.5rem;
    border-radius: 8px;
    margin-bottom: 2rem;
}

.date-input-group {
    display: flex;
    gap: 1rem;
    align-items: center;
    flex-wrap: wrap;
}

.date-input {
    padding: 0.75rem;
    border: 2px solid #e0e0e0;
    border-radius: 6px;
    font-size: 1rem;
}

/* Report Cards */
.report-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.report-card {
    background: white;
    padding: 1.5rem;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    text-align: center;
}

.report-card.income { border-top: 4px solid #4caf50; }
.report-card.expenses { border-top: 4px solid #f44336; }
.report-card.sales { border-top: 4px solid #2196f3; }
.report-card.inventory { border-top: 4px solid #ff9800; }

.report-value {
    font-size: 2rem;
    font-weight: bold;
    margin: 0.5rem 0;
}

.report-value.positive { color: #4caf50; }
.report-value.negative { color: #f44336; }
.report-value.neutral { color: #666; }

.report-change {
    font-size: 0.9rem;
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    display: inline-block;
}

.report-change.positive { background: #e8f5e8; color: #2e7d32; }
.report-change.negative { background: #ffebee; color: #c62828; }

/* Charts Container */
.report-charts {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 2rem;
    margin-bottom: 2rem;
}

.chart-container {
    background: white;
    padding: 1.5rem;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.chart-title {
    margin: 0 0 1rem 0;
    color: #2e7d32;
    font-size: 1.2rem;
}

/* Report Tables */
.report-tables {
    display: grid;
    gap: 2rem;
}

.report-table-container {
    background: white;
    padding: 1.5rem;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.report-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 1rem;
}

.report-table th,
.report-table td {
    padding: 0.75rem;
    text-align: left;
    border-bottom: 1px solid #e0e0e0;
}

.report-table th {
    background: #f8f9fa;
    font-weight: 600;
    color: #2e7d32;
}

.report-table tr:hover {
    background: #f5f5f5;
}

/* Export Options */
.export-options {
    display: flex;
    gap: 1rem;
    margin-top: 2rem;
    flex-wrap: wrap;
}

.export-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    border: 2px solid #388e3c;
    background: white;
    color: #388e3c;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
}

.export-btn:hover {
    background: #388e3c;
    color: white;
}

/* Quick Stats for Reports */
.quick-report-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
}

.quick-stat {
    background: white;
    padding: 1rem;
    border-radius: 8px;
    text-align: center;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.quick-stat-value {
    font-size: 1.5rem;
    font-weight: bold;
    color: #2e7d32;
}

.quick-stat-label {
    font-size: 0.8rem;
    color: #666;
    margin-top: 0.25rem;
}

/* Responsive Design */
@media (max-width: 768px) {
    .report-charts {
        grid-template-columns: 1fr;
    }
    
    .report-cards {
        grid-template-columns: 1fr;
    }
    
    .date-input-group {
        flex-direction: column;
    }
    
    .report-period-selector {
        justify-content: center;
    }
}

/* Print Styles */
@media print {
    .report-period-selector,
    .export-options,
    .section-header button {
        display: none;
    }
    
    .report-card,
    .chart-container,
    .report-table-container {
        box-shadow: none;
        border: 1px solid #ddd;
    }

}
  }
</style>
</head>
<body>
<header>
  <div>FarmPro Assistant</div>
  <div style="font-size: 0.9rem; font-weight: normal; margin-top: 0.3rem;">Cultivate Your Success</div>
</header>

<main>
<!-- Enhanced GPS Section -->
<section id="gpsSection" class="gps-section">
    <!-- Farm Profile Card (Shows after activation) -->
    <div class="farm-profile-card" id="farmProfileCard" style="display: none;">
        <div class="farm-header">
            <div class="farm-icon">üèûÔ∏è</div>
            <div class="farm-name-display" id="farmNameDisplay">My Farm</div>
            <div class="farm-coordinates" id="farmCoordinates">Loading coordinates...</div>
        </div>
        
        <div class="farm-actions">
            <button class="farm-action-btn primary" onclick="viewOnGoogleMaps()">
                <span>üó∫Ô∏è</span> View on Maps
            </button>
            <button class="farm-action-btn secondary" onclick="shareFarmViaWhatsApp()">
                <span>üí¨</span> Share via WhatsApp
            </button>
        </div>
        
        <div class="farm-name-form">
            <h4>Edit Farm Name</h4>
            <div class="farm-name-input-group">
                <input type="text" id="farmNameInput" class="farm-name-input" placeholder="Enter your farm name">
                <button class="save-farm-btn" onclick="saveFarmName()">Save</button>
            </div>
        </div>
    </div>

    <!-- Trial Status Card (Shows during trial) -->
    <div class="trial-status-card" id="trialStatus" style="display: none;">
        <h3>üéØ Trial Period Active</h3>
        <div class="trial-timer" id="trialTimer">7 days remaining</div>
        <p>Complete activation to unlock full features</p>
    </div>

    <!-- Activation Section (Shows when farm location is confirmed) -->
    <div class="activation-section" id="activationSection" style="display: none;">
        <h3>üîë Activate Full Access</h3>
        <p>Your farm location has been confirmed!</p>
        <button onclick="showActivationModal()" class="btn primary">Enter Activation Code</button>
    </div>

    <!-- GPS Controls (Always visible) -->
    <div class="gps-controls">
        <button id="gpsBtn" onclick="captureGPS()" class="btn primary large">
            üìç Capture GPS Location
        </button>
        
        <div class="gps-status">
            <div id="initialGpsStatus" class="muted">Initial location: Not captured</div>
            <div id="confirmedGpsStatus" class="muted">Farm location: Not confirmed</div>
        </div>
    </div>
</section>

<!-- Activation Modal (Keep this if you already have it, or add it) -->
<div id="activationModal" class="modal" style="display: none;">
    <div class="modal-content">
        <h3>Enter Activation Code</h3>
        <input type="text" id="activationCode" placeholder="Enter code from support">
        <div class="modal-actions">
            <button onclick="activateApp()" class="btn primary">Activate</button>
            <button onclick="closeActivationModal()" class="btn btn-outline">Cancel</button>
        </div>
    </div>
</div>
</section>

<!-- Dashboard Section (Initially Hidden) -->
<section id="dashboardSection" style="display: none;">
  <h2>Farm Dashboard</h2>
  
  <div class="dashboard-grid">
    <div class="stat-card">
      <div class="stat-label">Total Planted Area</div>
      <div class="stat-value" id="totalArea">0 ha</div>
      <div class="muted" id="cropCount">0 crops planted</div>
    </div>
    
    <div class="stat-card info">
      <div class="stat-label">Financial Balance</div>
      <div class="stat-value" id="financeBalance">0 Pula</div>
      <div class="muted" id="financeStatus">Net balance</div>
    </div>
    
    <div class="stat-card warning">
      <div class="stat-label">Inventory Value</div>
      <div class="stat-value" id="inventoryValue">0 Pula</div>
      <div class="muted" id="inventoryCount">0 items in stock</div>
    </div>
    
    <div class="stat-card">
      <div class="stat-label">Today's Sales</div>
      <div class="stat-value" id="todaySales">0 Pula</div>
      <div class="muted" id="salesCount">0 transactions</div>
    </div>
  </div>

  <!-- Farm Coordinates Display (Visible after trial expiry) -->
  <div id="coordinatesDisplay" style="display: none; margin-top: 1.5rem; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
    <h3>Farm Coordinates for Support</h3>
    <div id="coordinatesValue" style="font-family: monospace; font-size: 1.1rem; margin: 0.5rem 0;"></div>
    <div class="muted">Send these coordinates to support for activation code</div>
  </div>

  <div class="quick-actions">
    <div class="quick-action-btn" onclick="showSection('cropGuideSection')">
      <div class="action-icon">CG</div>
      <div>Crop Guide</div>
    </div>
    <div class="quick-action-btn" onclick="showSection('myCropsSection')">
      <div class="action-icon">MC</div>
      <div>My Crops</div>
    </div>
    <div class="quick-action-btn" onclick="showSection('tasksSection')">
      <div class="action-icon">TS</div>
      <div>Tasks</div>
    </div>
    <div class="quick-action-btn" onclick="showSection('clientsSection')">
      <div class="action-icon">CL</div>
      <div>Clients</div>
    </div>
    <div class="quick-action-btn" onclick="showSection('posSection')">
      <div class="action-icon">PS</div>
      <div>Point of Sale</div>
    </div>
    <div class="quick-action-btn" onclick="showSection('inventorySection')">
      <div class="action-icon">IN</div>
      <div>Inventory</div>
    </div>
    <div class="quick-action-btn" onclick="showSection('financeSection')">
      <div class="action-icon">FN</div>
      <div>Finance</div>
    </div>
    <div class="quick-action-btn" onclick="showSection('reportsSection')">
      <div class="action-icon">RP</div>
      <div>Reports</div>
    </div>
  </div>
</section>

<!-- Point of Sale Section -->
<section id="posSection" style="display: none;">
  <h2>Point of Sale</h2>
  
  <div class="pos-grid">
    <div class="pos-items">
      <h3>Available Products</h3>
      <div id="posProductsList">
        <!-- Products will be loaded here from inventory -->
      </div>
    </div>
    
    <div class="pos-cart">
      <h3>Shopping Cart</h3>
      <div id="posCart">
        <!-- Cart items will be displayed here -->
        <div style="text-align: center; padding: 2rem; color: var(--muted);">
          Cart is empty
        </div>
      </div>
      
      <div class="cart-total">
        Total: <span id="cartTotal">0.00</span> Pula
      </div>
      
      <div class="action-buttons" style="margin-top: 1rem;">
        <button onclick="completeSale()" id="completeSaleBtn" disabled>Complete Sale</button>
        <button onclick="clearCart()" class="btn-outline">Clear Cart</button>
      </div>
    </div>
  </div>
</section>

<!-- Inventory Section -->
<section id="inventorySection" style="display: none;">
  <h2>Inventory Management</h2>
  
  <div class="row">
    <div class="col">
      <h3>Add New Product</h3>
      <label>Product Name:</label>
      <input type="text" id="productName" placeholder="e.g., Maize, Tomatoes">
      
      <label>Category:</label>
      <select id="productCategory">
        <option value="crops">Crops</option>
        <option value="seeds">Seeds</option>
        <option value="tools">Tools</option>
        <option value="supplies">Supplies</option>
      </select>
      
      <label>Quantity:</label>
      <input type="number" id="productQuantity" placeholder="0">
      
      <label>Unit Price (Pula):</label>
      <input type="number" id="productPrice" placeholder="0.00" step="0.01">
      
      <button onclick="addProduct()" style="margin-top: 1rem;">Add Product</button>
    </div>
    
    <div class="col">
      <h3>Current Inventory</h3>
      <div id="inventoryList" class="inventory-grid">
        <!-- Inventory items will be displayed here -->
      </div>
    </div>
  </div>
</section>

<!-- Finance Section -->
<section id="financeSection" style="display: none;">
  <h2>Financial Management</h2>
  
  <div class="finance-summary">
    <div class="finance-card income">
      <div class="stat-label">Total Income</div>
      <div class="stat-value" id="totalIncome">0 Pula</div>
    </div>
    
    <div class="finance-card expense">
      <div class="stat-label">Total Expenses</div>
      <div class="stat-value" id="totalExpenses">0 Pula</div>
    </div>
    
    <div class="finance-card balance">
      <div class="stat-label">Net Balance</div>
      <div class="stat-value" id="netBalance">0 Pula</div>
    </div>
  </div>
  
  <div class="row">
    <div class="col">
      <h3>Add Income</h3>
      <label>Description:</label>
      <input type="text" id="incomeDescription" placeholder="e.g., Maize sale">
      
      <label>Amount (Pula):</label>
      <input type="number" id="incomeAmount" placeholder="0.00" step="0.01">
      
      <label>Category:</label>
      <select id="incomeCategory">
        <option value="sales">Crop Sales</option>
        <option value="services">Services</option>
        <option value="other">Other Income</option>
      </select>
      
      <button onclick="addIncome()" style="margin-top: 1rem;">Add Income</button>
    </div>
    
    <div class="col">
      <h3>Add Expense</h3>
      <label>Description:</label>
      <input type="text" id="expenseDescription" placeholder="e.g., Seeds purchase">
      
      <label>Amount (Pula):</label>
      <input type="number" id="expenseAmount" placeholder="0.00" step="0.01">
      
      <label>Category:</label>
      <select id="expenseCategory">
        <option value="seeds">Seeds</option>
        <option value="fertilizer">Fertilizer</option>
        <option value="tools">Tools & Equipment</option>
        <option value="labor">Labor</option>
        <option value="other">Other Expenses</option>
      </select>
      
      <button onclick="addExpense()" style="margin-top: 1rem;">Add Expense</button>
    </div>
  </div>
  
  <h3 style="margin-top: 1.5rem;">Recent Transactions</h3>
  <div id="transactionList" class="transaction-list">
    <!-- Transactions will be displayed here -->
  </div>
</section>

<!-- Crop Guide Section -->
<!-- Enhanced Crop Guide Section -->
<section id="cropGuideSection" style="display: none;">
    <div class="section-header">
        <h2><span class="icon icon-large icon-vegetable"></span> Crop Knowledge Base</h2>
        <p>Comprehensive guide for 30+ crops with seasonal planning and detailed care instructions</p>
    </div>

    <div class="crop-guide-container">
        <!-- Filter Sidebar -->
        <div class="crop-filter-sidebar">
            <div class="filter-section">
                <h4><span class="icon icon-medium icon-search"></span> Search Crops</h4>
                <input type="text" id="cropSearch" class="form-input" placeholder="Search by crop name..." onkeyup="filterCrops()">
            </div>

            <div class="filter-section">
                <h4><span class="icon icon-medium icon-filter"></span> Crop Type</h4>
                <div class="filter-options" id="typeFilters">
                    <div class="filter-option active" onclick="filterByType('all')">
                        <span class="icon icon-small icon-vegetable"></span>
                        <span>All Crops</span>
                    </div>
                    <div class="filter-option" onclick="filterByType('Cereal')">
                        <span class="icon icon-small icon-cereal"></span>
                        <span>Cereals</span>
                    </div>
                    <div class="filter-option" onclick="filterByType('Oilseed')">
                        <span class="icon icon-small icon-oilseed"></span>
                        <span>Oilseeds</span>
                    </div>
                    <div class="filter-option" onclick="filterByType('Vegetable')">
                        <span class="icon icon-small icon-vegetable"></span>
                        <span>Vegetables</span>
                    </div>
                    <div class="filter-option" onclick="filterByType('Tuber')">
                        <span class="icon icon-small icon-tuber"></span>
                        <span>Tubers & Roots</span>
                    </div>
                    <div class="filter-option" onclick="filterByType('Legume')">
                        <span class="icon icon-small icon-legume"></span>
                        <span>Legumes</span>
                    </div>
                    <div class="filter-option" onclick="filterByType('Fruit')">
                        <span class="icon icon-small icon-fruit"></span>
                        <span>Fruits</span>
                    </div>
                </div>
            </div>

            <div class="filter-section">
                <h4><span class="icon icon-medium icon-water"></span> Water Needs</h4>
                <div class="filter-options" id="waterFilters">
                    <div class="filter-option active" onclick="filterByWater('all')">
                        <span>All Water Needs</span>
                    </div>
                    <div class="filter-option" onclick="filterByWater('Low')">
                        <span>Low Water</span>
                    </div>
                    <div class="filter-option" onclick="filterByWater('Medium')">
                        <span>Medium Water</span>
                    </div>
                    <div class="filter-option" onclick="filterByWater('High')">
                        <span>High Water</span>
                    </div>
                </div>
            </div>

            <div class="filter-section">
                <h4><span class="icon icon-medium icon-calendar"></span> Planting Season</h4>
                <div class="filter-options" id="seasonFilters">
                    <div class="filter-option active" onclick="filterBySeason('all')">
                        <span>All Seasons</span>
                    </div>
                    <div class="filter-option" onclick="filterBySeason('Summer')">
                        <span>Summer (Nov-Jan)</span>
                    </div>
                    <div class="filter-option" onclick="filterBySeason('Winter')">
                        <span>Winter (May-Jul)</span>
                    </div>
                    <div class="filter-option" onclick="filterBySeason('Year-round')">
                        <span>Year-round</span>
                    </div>
                </div>
            </div>

            <button class="btn btn-outline" onclick="clearFilters()" style="width: 100%; margin-top: 1rem;">
                <span class="icon icon-small" style="background-image: url('data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 24 24\' fill=\'%23388e3c\'%3E%3Cpath d=\'M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z\'/%3E%3C/svg%3E');"></span>
                Clear Filters
            </button>
        </div>

        <!-- Main Content Area -->
        <div class="crop-guide-content">
            <!-- Quick Stats -->
            <div class="quick-stats-bar">
                <div class="stat-card">
                    <div class="stat-number" id="totalCrops">30</div>
                    <div class="stat-label">Total Crops</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="activeFilters">0</div>
                    <div class="stat-label">Active Filters</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="currentSeason">Summer</div>
                    <div class="stat-label">Current Season</div>
                </div>
            </div>

            <!-- Crop Grid -->
            <div class="crop-grid" id="cropGrid">
                <!-- Crop cards will be dynamically generated here -->
            </div>

            <!-- No Results Message -->
            <div id="noResults" style="display: none; text-align: center; padding: 3rem;">
                <div style="font-size: 4rem; color: #ccc;">
                    <span class="icon icon-xlarge icon-search"></span>
                </div>
                <h3>No crops found</h3>
                <p>Try adjusting your filters or search terms</p>
                <button class="btn primary" onclick="clearFilters()">
                    <span class="icon icon-small" style="background-image: url('data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 24 24\' fill=\'white\'%3E%3Cpath d=\'M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z\'/%3E%3C/svg%3E');"></span>
                    Show All Crops
                </button>
            </div>
        </div>
    </div>

    <!-- Enhanced Crop Details Modal -->
    <div id="enhancedCropModal" class="modal" style="display: none;">
        <div class="modal-content large">
            <div class="modal-header">
                <h3 id="modalCropName">Crop Details</h3>
                <button class="close-btn" onclick="closeEnhancedCropModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div id="enhancedCropDetails">
                    <!-- Enhanced crop details will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Seasonal Planning Section -->
    <div class="seasonal-planning">
        <h3><span class="icon icon-medium icon-calendar"></span> Seasonal Planting Calendar</h3>
        <p>Plan your farming activities based on optimal planting seasons</p>
        
        <div class="season-calendar" id="seasonCalendar">
            <!-- Calendar will be dynamically generated -->
        </div>
        
        <div class="current-recommendations">
            <h4><span class="icon icon-small icon-vegetable"></span> Recommended for Current Season</h4>
            <div id="currentSeasonCrops" class="crop-recommendations">
                <!-- Current season crops will be loaded here -->
            </div>
        </div>
    </div>
</section>

<!-- My Crops Section -->
<section id="myCropsSection" style="display: none;">
  <h2>My Planted Crops</h2>
  
  <div class="row">
    <div class="col">
      <h3>Plant New Crop</h3>
      <label>Crop Type:</label>
      <select id="plantCropType">
        <!-- Options will be populated from crop database -->
      </select>
      
      <label>Area (Hectares):</label>
      <input type="number" id="plantArea" placeholder="0.0" step="0.1">
      
      <label>Planting Date:</label>
      <input type="date" id="plantDate">
      
      <button onclick="plantCrop()" style="margin-top: 1rem;" class="btn-harvest">Plant Crop</button>
    </div>
    
    <div class="col">
      <h3>Planted Crops</h3>
      <div id="plantedCropsList">
        <!-- Planted crops will be displayed here -->
      </div>
    </div>
  </div>
</section>

<!-- Tasks Section -->
<section id="tasksSection" style="display: none;">
  <h2>Farm Tasks</h2>
  
  <div class="row">
    <div class="col">
      <h3>Create New Task</h3>
      <label>Task Description:</label>
      <input type="text" id="taskDescription" placeholder="e.g., Fertilize maize field">
      
      <label>Start Date:</label>
      <input type="date" id="taskStartDate">
      
      <label>Due Date:</label>
      <input type="date" id="taskDueDate">
      
      <label>Priority:</label>
      <select id="taskPriority">
        <option value="low">Low</option>
        <option value="medium">Medium</option>
        <option value="high">High</option>
      </select>
      
      <button onclick="createTask()" style="margin-top: 1rem;">Create Task</button>
    </div>
    
    <div class="col">
      <h3>Active Tasks</h3>
      <div id="tasksList">
        <!-- Tasks will be displayed here -->
      </div>
    </div>
  </div>
</section>

<!-- Clients Section -->
<section id="clientsSection" style="display: none;">
  <h2>Client Management</h2>
  
  <div class="row">
    <div class="col">
      <h3>Add New Client</h3>
      <label>Client Name:</label>
      <input type="text" id="clientName" placeholder="Full name">
      
      <label>Contact Number:</label>
      <input type="text" id="clientContact" placeholder="Phone number">
      
      <label>Email Address:</label>
      <input type="email" id="clientEmail" placeholder="Email address">
      
      <label>Desired Crop:</label>
      <select id="clientCrop">
        <!-- Options will be populated from crop database -->
      </select>
      
      <label>Notes:</label>
      <textarea id="clientNotes" placeholder="Additional information"></textarea>
      
      <button onclick="addClient()" style="margin-top: 1rem;" class="btn-harvest">Add Client</button>
    </div>
    
    <div class="col">
      <h3>Client List</h3>
      <div id="clientsList">
        <!-- Clients will be displayed here -->
      </div>
    </div>
  </div>
</section>

<!-- Enhanced Reports Section -->
<section id="reportsSection" style="display: none;">
    <div class="section-header">
        <h2>üìä Farm Analytics & Reports</h2>
        <p>Comprehensive reporting with weekly, monthly, and yearly insights</p>
    </div>

    <!-- Report Period Selector -->
    <div class="report-period-selector">
        <button class="period-btn active" onclick="setReportPeriod('weekly')">
            üìÖ Weekly Report
        </button>
        <button class="period-btn" onclick="setReportPeriod('monthly')">
            üìä Monthly Report
        </button>
        <button class="period-btn" onclick="setReportPeriod('yearly')">
            üìà Yearly Report
        </button>
        <button class="period-btn" onclick="setReportPeriod('custom')">
            üéØ Custom Range
        </button>
    </div>

    <!-- Date Range Selector (for custom reports) -->
    <div id="customDateRange" class="date-range-selector" style="display: none;">
        <h4>Select Date Range</h4>
        <div class="date-input-group">
            <input type="date" id="startDate" class="date-input">
            <span>to</span>
            <input type="date" id="endDate" class="date-input">
            <button class="btn primary" onclick="generateCustomReport()">
                Generate Report
            </button>
        </div>
    </div>

    <!-- Quick Stats -->
    <div class="quick-report-stats" id="reportQuickStats">
        <!-- Quick stats will be loaded here -->
    </div>

    <!-- Report Cards -->
    <div class="report-cards" id="reportCards">
        <!-- Report cards will be loaded here -->
    </div>

    <!-- Charts -->
    <div class="report-charts">
        <div class="chart-container">
            <h4 class="chart-title">Income vs Expenses</h4>
            <canvas id="incomeExpenseChart" width="400" height="200"></canvas>
        </div>
        <div class="chart-container">
            <h4 class="chart-title">Sales by Category</h4>
            <canvas id="salesCategoryChart" width="400" height="200"></canvas>
        </div>
        <div class="chart-container">
            <h4 class="chart-title">Crop Performance</h4>
            <canvas id="cropPerformanceChart" width="400" height="200"></canvas>
        </div>
        <div class="chart-container">
            <h4 class="chart-title">Inventory Value Trend</h4>
            <canvas id="inventoryTrendChart" width="400" height="200"></canvas>
        </div>
    </div>

    <!-- Detailed Tables -->
    <div class="report-tables">
        <div class="report-table-container">
            <h4>Recent Transactions</h4>
            <div id="transactionTable">
                <!-- Transaction table will be loaded here -->
            </div>
        </div>

        <div class="report-table-container">
            <h4>Top Selling Products</h4>
            <div id="topProductsTable">
                <!-- Top products table will be loaded here -->
            </div>
        </div>

        <div class="report-table-container">
            <h4>Crop Progress Summary</h4>
            <div id="cropProgressTable">
                <!-- Crop progress table will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Export Options -->
    <div class="export-options">
        <button class="export-btn" onclick="exportReport('pdf')">
            üìÑ Export as PDF
        </button>
        <button class="export-btn" onclick="exportReport('excel')">
            üìä Export as Excel
        </button>
        <button class="export-btn" onclick="printReport()">
            üñ®Ô∏è Print Report
        </button>
        <button class="export-btn" onclick="scheduleReport()">
            ‚è∞ Schedule Report
        </button>
    </div>

    <!-- Scheduled Reports Modal -->
    <div id="scheduleModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>Schedule Automated Reports</h3>
            <div class="schedule-options">
                <label>
                    <input type="checkbox" id="weeklyEmail"> Weekly report every Monday
                </label>
                <label>
                    <input type="checkbox" id="monthlyEmail"> Monthly report on 1st of month
                </label>
                <label>
                    <input type="checkbox" id="yearlyEmail"> Yearly report on January 1st
                </label>
            </div>
            <div class="modal-actions">
                <button class="btn primary" onclick="saveSchedule()">Save Schedule</button>
                <button class="btn btn-outline" onclick="closeScheduleModal()">Cancel</button>
            </div>
        </div>
    </div>
</section>
</main>

<!-- Activation Modal -->
<div id="activationModal" class="activation-modal">
  <div class="activation-content">
    <h2>Activate FarmPro</h2>
    <p>Enter the activation code provided by support:</p>
    
    <input type="text" id="activationCode" placeholder="Enter activation code" style="margin: 1rem 0; font-size: 1.2rem; text-align: center; letter-spacing: 2px;">
    
    <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
      <button onclick="activateApp()" style="flex: 1;">Activate</button>
      <button onclick="closeActivationModal()" class="btn-outline" style="flex: 1;">Cancel</button>
    </div>
    
    <div class="muted" style="margin-top: 1rem;">
      Contact support: +267 7678 1005 / +267 7293 3326
    </div>
  </div>
</div>

<footer>
  <div class="contact-info">Contact Support: +267 7678 1005 / +267 7293 3326</div>
  <div class="support-text">FarmPro Assistant - Cultivate Your Success</div>
</footer>

<script>
// FarmPro Assistant - Complete JavaScript
document.addEventListener('DOMContentLoaded', function() {
    
// =============================================
// APP STATE AND DATA MANAGEMENT
// =============================================

// Initialize app state
let gpsData = JSON.parse(localStorage.getItem('fa_gps') || '{"initial":null,"confirmed":null,"trialStart":null,"activated":false}');
let trialActive = false;
let trialExpired = false;
let appActivated = gpsData.activated || false;

// Initialize data storage - FIXED VERSION
let farmData;
try {
    const savedData = localStorage.getItem('fa_data');
    if (savedData) {
        farmData = JSON.parse(savedData);
    } else {
        // Initialize with default structure
        farmData = {
            inventory: [],
            finances: {
                income: [],
                expenses: [],
                balance: 0
            },
            sales: [],
            plantedCrops: [],
            tasks: [],
            clients: []
        };
        // Save initial structure
        localStorage.setItem('fa_data', JSON.stringify(farmData));
    }
} catch (error) {
    console.error('Error loading farm data:', error);
    // Initialize with default structure if error
    farmData = {
        inventory: [],
        finances: {
            income: [],
            expenses: [],
            balance: 0
        },
        sales: [],
        plantedCrops: [],
        tasks: [],
        clients: []
    };
}

// POS variables
let posCart = [];

// =============================================
// UTILITY FUNCTIONS
// =============================================

// Safe DOM element access
function getElement(id) {
    const element = document.getElementById(id);
    if (!element) {
        console.warn(`Element with id '${id}' not found`);
    }
    return element;
}

// Save data to localStorage - ENHANCED VERSION
function saveData() {
    try {
        console.log('Saving data:', farmData);
        localStorage.setItem('fa_data', JSON.stringify(farmData));
        console.log('Data saved successfully');
        updateDashboard();
        return true;
    } catch (error) {
        console.error('Error saving data:', error);
        alert('Error saving data. Please try again.');
        return false;
    }
}

// =============================================
// DASHBOARD FUNCTIONS
// =============================================

function updateDashboard() {
    try {
        // Calculate inventory value
        const inventoryValue = farmData.inventory.reduce((total, item) => {
            return total + (item.quantity * item.price);
        }, 0);
        
        // Calculate today's sales
        const today = new Date().toDateString();
        const todaySales = farmData.sales
            .filter(sale => new Date(sale.timestamp).toDateString() === today)
            .reduce((total, sale) => total + sale.total, 0);
        
        // Calculate total planted area
        const totalArea = farmData.plantedCrops.reduce((total, crop) => total + crop.area, 0);
        
        // Update dashboard values safely
        const totalAreaEl = getElement('totalArea');
        const cropCountEl = getElement('cropCount');
        const inventoryValueEl = getElement('inventoryValue');
        const inventoryCountEl = getElement('inventoryCount');
        const todaySalesEl = getElement('todaySales');
        const salesCountEl = getElement('salesCount');
        const financeBalanceEl = getElement('financeBalance');
        
        if (totalAreaEl) totalAreaEl.textContent = totalArea.toFixed(1) + ' ha';
        if (cropCountEl) cropCountEl.textContent = `${farmData.plantedCrops.length} crops planted`;
        if (inventoryValueEl) inventoryValueEl.textContent = inventoryValue.toFixed(2);
        if (inventoryCountEl) inventoryCountEl.textContent = `${farmData.inventory.length} items in stock`;
        if (todaySalesEl) todaySalesEl.textContent = todaySales.toFixed(2);
        if (salesCountEl) salesCountEl.textContent = `${farmData.sales.length} transactions`;
        if (financeBalanceEl) financeBalanceEl.textContent = farmData.finances.balance.toFixed(2);
    } catch (error) {
        console.error('Error updating dashboard:', error);
    }
}

// =============================================
// GPS & ACTIVATION FUNCTIONS
// =============================================

// =============================================
// ENHANCED GPS & FARM PROFILE FUNCTIONS
// =============================================

function captureGPS() {
    if (!navigator.geolocation) {
        alert('Your browser does not support GPS. Please use Chrome, Firefox, or Safari.');
        return;
    }

    const gpsBtn = getElement('gpsBtn');
    if (!gpsBtn) return;
    
    gpsBtn.disabled = true;
    gpsBtn.innerHTML = 'Getting Location...';

    navigator.geolocation.getCurrentPosition(
        function(position) {
            const coords = {
                lat: position.coords.latitude.toFixed(6),
                lon: position.coords.longitude.toFixed(6),
                accuracy: Math.round(position.coords.accuracy),
                timestamp: new Date().toISOString()
            };

            if (!gpsData.initial) {
                // First capture - start trial
                gpsData.initial = coords;
                gpsData.trialStart = new Date().toISOString();
                localStorage.setItem('fa_gps', JSON.stringify(gpsData));
                
                updateGPSStatus();
                startTrial();
                
                gpsBtn.innerHTML = 'Confirm Farm Location';
                alert('Initial location captured! 7-day trial started.\n\nPlease go to your farm and capture location again for activation.');
                
            } else if (!gpsData.confirmed) {
                // Second capture - confirmed farm location
                gpsData.confirmed = coords;
                localStorage.setItem('fa_gps', JSON.stringify(gpsData));
                
                updateGPSStatus();
                const activateBtn = getElement('activateBtn');
                if (activateBtn) activateBtn.style.display = 'block';
                gpsBtn.innerHTML = 'Location Confirmed';
                
                alert('Farm location confirmed!\n\nYou can now activate the app with code from support.');
                
            } else {
                // Already have both captures
                alert('Location already captured. Use "Activate App" to enter activation code.');
            }
            
            gpsBtn.disabled = false;
        },
        function(error) {
            if (gpsBtn) {
                gpsBtn.disabled = false;
                gpsBtn.innerHTML = 'Capture GPS Location';
            }
            
            let errorMessage = 'Could not get location: ';
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    errorMessage += 'Please allow location access.';
                    break;
                case error.POSITION_UNAVAILABLE:
                    errorMessage += 'Location unavailable.';
                    break;
                case error.TIMEOUT:
                    errorMessage += 'Request timed out.';
                    break;
                default:
                    errorMessage += 'Please try again.';
                    break;
            }
            alert(errorMessage);
        },
        {
            enableHighAccuracy: true,
            timeout: 15000,
            maximumAge: 0
        }
    );
}

function updateGPSStatus() {
    const initialStatus = getElement('initialGpsStatus');
    const confirmedStatus = getElement('confirmedGpsStatus');
    const trialStatus = getElement('trialStatus');
    const farmProfileCard = getElement('farmProfileCard');
    const activationSection = getElement('activationSection');
    
    // Update status displays
    if (gpsData.initial && initialStatus) {
        initialStatus.innerHTML = 
            `Initial Location: ${gpsData.initial.lat}, ${gpsData.initial.lon}`;
    }
    
    if (gpsData.confirmed && confirmedStatus) {
        confirmedStatus.innerHTML = 
            `Farm Location: ${gpsData.confirmed.lat}, ${gpsData.confirmed.lon}`;
    }
    
    // Handle trial and activation states
    if (appActivated) {
        // Hide trial section and show farm profile
        if (trialStatus) trialStatus.style.display = 'none';
        if (activationSection) activationSection.style.display = 'none';
        if (farmProfileCard) {
            farmProfileCard.style.display = 'block';
            loadFarmProfile();
        }
    } else if (trialActive) {
        // Show trial status
        if (trialStatus) trialStatus.style.display = 'block';
        if (activationSection && gpsData.confirmed) {
            activationSection.style.display = 'block';
        }
        if (farmProfileCard) farmProfileCard.style.display = 'none';
    }
}

function loadFarmProfile() {
    const farmNameInput = getElement('farmNameInput');
    const farmCoordinates = getElement('farmCoordinates');
    const farmNameDisplay = getElement('farmNameDisplay');
    
    if (farmNameInput && gpsData.farmName) {
        farmNameInput.value = gpsData.farmName;
    }
    
    if (farmCoordinates && gpsData.confirmed) {
        farmCoordinates.textContent = `${gpsData.confirmed.lat}, ${gpsData.confirmed.lon}`;
    }
    
    if (farmNameDisplay && gpsData.farmName) {
        farmNameDisplay.textContent = gpsData.farmName;
    } else if (farmNameDisplay) {
        farmNameDisplay.textContent = 'My Farm';
    }
}

function saveFarmName() {
    const farmNameInput = getElement('farmNameInput');
    if (!farmNameInput) return;
    
    const farmName = farmNameInput.value.trim();
    if (!farmName) {
        alert('Please enter a farm name');
        return;
    }
    
    gpsData.farmName = farmName;
    localStorage.setItem('fa_gps', JSON.stringify(gpsData));
    
    loadFarmProfile();
    alert('Farm name saved successfully!');
}

function shareFarmViaWhatsApp() {
    if (!gpsData.confirmed) {
        alert('No farm location available to share');
        return;
    }
    
    const farmName = gpsData.farmName || 'My Farm';
    const coordinates = `${gpsData.confirmed.lat}, ${gpsData.confirmed.lon}`;
    const googleMapsUrl = `https://www.google.com/maps?q=${gpsData.confirmed.lat},${gpsData.confirmed.lon}`;
    
    const message = `üèûÔ∏è *${farmName}*\n\nüìç Location: ${coordinates}\n\nüó∫Ô∏è View on Google Maps: ${googleMapsUrl}\n\nShared via FarmPro Assistant`;
    
    const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
    window.open(whatsappUrl, '_blank');
}

function viewOnGoogleMaps() {
    if (!gpsData.confirmed) {
        alert('No farm location available');
        return;
    }
    
    const mapsUrl = `https://www.google.com/maps?q=${gpsData.confirmed.lat},${gpsData.confirmed.lon}`;
    window.open(mapsUrl, '_blank');
}

function startTrial() {
    trialActive = true;
    const trialStatus = getElement('trialStatus');
    const dashboardSection = getElement('dashboardSection');
    
    if (trialStatus) trialStatus.style.display = 'block';
    if (dashboardSection) dashboardSection.style.display = 'block';
    startCountdown();
}

function startCountdown() {
    const trialStart = new Date(gpsData.trialStart);
    const trialEnd = new Date(trialStart.getTime() + 7 * 24 * 60 * 60 * 1000);
    
    function updateTimer() {
        const now = new Date();
        const timeLeft = trialEnd - now;
        const trialTimer = getElement('trialTimer');
        
        if (!trialTimer) return;
        
        if (timeLeft <= 0) {
            // Trial expired
            trialTimer.textContent = 'Trial Expired';
            trialActive = false;
            trialExpired = true;
            
            if (!appActivated) {
                enableReadOnlyMode();
            }
            return;
        }
        
        const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
        const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        
        trialTimer.textContent = `${days}d ${hours}h remaining`;
    }
    
    updateTimer();
    setInterval(updateTimer, 60000);
}

function showActivationModal() {
    if (!gpsData.confirmed) {
        alert('Please capture your farm location first.');
        return;
    }
    const activationModal = getElement('activationModal');
    const activationCode = getElement('activationCode');
    
    if (activationModal) activationModal.style.display = 'flex';
    if (activationCode) activationCode.focus();
}

function closeActivationModal() {
    const activationModal = getElement('activationModal');
    const activationCode = getElement('activationCode');
    
    if (activationModal) activationModal.style.display = 'none';
    if (activationCode) activationCode.value = '';
}

function activateApp() {
    const activationCodeInput = getElement('activationCode');
    if (!activationCodeInput) return;
    
    const enteredCode = activationCodeInput.value.trim().toUpperCase();
    
    if (!enteredCode) {
        alert('Please enter an activation code.');
        return;
    }
    
    // Generate correct code from confirmed coordinates
    const correctCode = generateActivationCode(gpsData.confirmed);
    
    if (enteredCode === correctCode) {
        // Successful activation
        gpsData.activated = true;
        appActivated = true;
        localStorage.setItem('fa_gps', JSON.stringify(gpsData));
        
        closeActivationModal();
        enableFullAccess();
        updateGPSStatus(); // Update UI to show farm profile
        
        alert('App activated successfully! Enjoy full access.');
        
    } else {
        alert('Invalid activation code. Please check with support.');
    }
}

function generateActivationCode(coords) {
    // Convert digits to letters: 1=A, 2=B, 3=C, 4=D, 5=E, 6=F, 7=G, 8=H, 9=I, 0=0
    const digitMap = {
        '1': 'A', '2': 'B', '3': 'C', '4': 'D', '5': 'E',
        '6': 'F', '7': 'G', '8': 'H', '9': 'I', '0': '0'
    };
    
    // Remove all symbols and combine coordinates
    const coordinateString = (coords.lat + coords.lon).replace(/[^0-9]/g, '');
    
    // Convert each digit to corresponding letter
    let activationCode = '88';
    for (let char of coordinateString) {
        activationCode += digitMap[char] || char;
    }
    
    return activationCode;
}

function enableFullAccess() {
    document.querySelectorAll('section').forEach(section => {
        if (section.id !== 'gpsSection') {
            section.style.display = 'block';
        }
    });
    
    document.querySelectorAll('button').forEach(btn => {
        btn.disabled = false;
    });
    
    document.querySelectorAll('input, select').forEach(input => {
        input.disabled = false;
    });
    
    // Initialize app features
    initializeAppFeatures();
}

function enableReadOnlyMode() {
    // Show coordinates for support
    if (gpsData.confirmed) {
        const coordinatesDisplay = getElement('coordinatesDisplay');
        const coordinatesValue = getElement('coordinatesValue');
        
        if (coordinatesDisplay) coordinatesDisplay.style.display = 'block';
        if (coordinatesValue) coordinatesValue.textContent = 
            `${gpsData.confirmed.lat}, ${gpsData.confirmed.lon}`;
    }
    
    // Disable all interactive elements
    document.querySelectorAll('button').forEach(btn => {
        if (btn.id !== 'gpsBtn') {
            btn.disabled = true;
        }
    });
    
    document.querySelectorAll('input, select').forEach(input => {
        input.disabled = true;
    });
    
    document.body.classList.add('readonly-mode');
    
    alert('Trial period expired. Please contact support for activation.');
}

function startTrial() {
    trialActive = true;
    const trialStatus = getElement('trialStatus');
    const dashboardSection = getElement('dashboardSection');
    
    if (trialStatus) trialStatus.style.display = 'block';
    if (dashboardSection) dashboardSection.style.display = 'block';
    startCountdown();
}

function startCountdown() {
    const trialStart = new Date(gpsData.trialStart);
    const trialEnd = new Date(trialStart.getTime() + 7 * 24 * 60 * 60 * 1000);
    
    function updateTimer() {
        const now = new Date();
        const timeLeft = trialEnd - now;
        const trialTimer = getElement('trialTimer');
        
        if (!trialTimer) return;
        
        if (timeLeft <= 0) {
            // Trial expired
            trialTimer.textContent = 'Trial Expired';
            trialActive = false;
            trialExpired = true;
            
            if (!appActivated) {
                enableReadOnlyMode();
            }
            return;
        }
        
        const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
        const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        
        trialTimer.textContent = `${days}d ${hours}h remaining`;
    }
    
    updateTimer();
    setInterval(updateTimer, 60000);
}

function showActivationModal() {
    if (!gpsData.confirmed) {
        alert('Please capture your farm location first.');
        return;
    }
    const activationModal = getElement('activationModal');
    const activationCode = getElement('activationCode');
    
    if (activationModal) activationModal.style.display = 'flex';
    if (activationCode) activationCode.focus();
}

function closeActivationModal() {
    const activationModal = getElement('activationModal');
    const activationCode = getElement('activationCode');
    
    if (activationModal) activationModal.style.display = 'none';
    if (activationCode) activationCode.value = '';
}

function activateApp() {
    const activationCodeInput = getElement('activationCode');
    if (!activationCodeInput) return;
    
    const enteredCode = activationCodeInput.value.trim().toUpperCase();
    
    if (!enteredCode) {
        alert('Please enter an activation code.');
        return;
    }
    
    // Generate correct code from confirmed coordinates
    const correctCode = generateActivationCode(gpsData.confirmed);
    
    if (enteredCode === correctCode) {
        // Successful activation
        gpsData.activated = true;
        appActivated = true;
        localStorage.setItem('fa_gps', JSON.stringify(gpsData));
        
        closeActivationModal();
        enableFullAccess();
        
        alert('App activated successfully! Enjoy full access.');
        
    } else {
        alert('Invalid activation code. Please check with support.');
    }
}

function generateActivationCode(coords) {
    // Convert digits to letters: 1=A, 2=B, 3=C, 4=D, 5=E, 6=F, 7=G, 8=H, 9=I, 0=0
    const digitMap = {
        '1': 'A', '2': 'B', '3': 'C', '4': 'D', '5': 'E',
        '6': 'F', '7': 'G', '8': 'H', '9': 'I', '0': '0'
    };
    
    // Remove all symbols and combine coordinates
    const coordinateString = (coords.lat + coords.lon).replace(/[^0-9]/g, '');
    
    // Convert each digit to corresponding letter
    let activationCode = '88';
    for (let char of coordinateString) {
        activationCode += digitMap[char] || char;
    }
    
    return activationCode;
}

function enableFullAccess() {
    document.querySelectorAll('section').forEach(section => {
        if (section.id !== 'gpsSection') {
            section.style.display = 'block';
        }
    });
    
    document.querySelectorAll('button').forEach(btn => {
        btn.disabled = false;
    });
    
    document.querySelectorAll('input, select').forEach(input => {
        input.disabled = false;
    });
    
    // Initialize app features
    initializeAppFeatures();
}

function enableReadOnlyMode() {
    // Show coordinates for support
    if (gpsData.confirmed) {
        const coordinatesDisplay = getElement('coordinatesDisplay');
        const coordinatesValue = getElement('coordinatesValue');
        
        if (coordinatesDisplay) coordinatesDisplay.style.display = 'block';
        if (coordinatesValue) coordinatesValue.textContent = 
            `${gpsData.confirmed.lat}, ${gpsData.confirmed.lon}`;
    }
    
    // Disable all interactive elements
    document.querySelectorAll('button').forEach(btn => {
        if (btn.id !== 'gpsBtn') {
            btn.disabled = true;
        }
    });
    
    document.querySelectorAll('input, select').forEach(input => {
        input.disabled = true;
    });
    
    document.body.classList.add('readonly-mode');
    
    alert('Trial period expired. Please contact support for activation.');
}

// =============================================
// NAVIGATION FUNCTIONS
// =============================================

function showSection(sectionId) {
    if (!appActivated && trialExpired) {
        alert('Trial expired. Please contact support for activation.');
        return;
    }
    
    document.querySelectorAll('section').forEach(section => {
        if (section.id !== 'gpsSection' && section.id !== 'dashboardSection') {
            section.style.display = 'none';
        }
    });
    
    const targetSection = getElement(sectionId);
    if (targetSection) targetSection.style.display = 'block';
    
    // Load section-specific data
    if (sectionId === 'posSection') {
        loadPOSProducts();
    } else if (sectionId === 'inventorySection') {
        loadInventory();
    } else if (sectionId === 'financeSection') {
        loadFinanceData();
    } else if (sectionId === 'cropGuideSection') {
        loadCropGuide();
    } else if (sectionId === 'myCropsSection') {
        loadMyCrops();
    } else if (sectionId === 'tasksSection') {
        loadTasks();
    } else if (sectionId === 'clientsSection') {
        loadClients();
    } else if (sectionId === 'reportsSection') {
        // Reports don't need initial loading
    }
}

// =============================================
// POS FUNCTIONS
// =============================================

function loadPOSProducts() {
    const productsList = getElement('posProductsList');
    if (!productsList) return;
    
    productsList.innerHTML = '';
    
    farmData.inventory.forEach((product, index) => {
        if (product.quantity > 0) {
            const productElement = document.createElement('div');
            productElement.className = 'pos-item';
            productElement.innerHTML = `
                <div>
                    <strong>${product.name}</strong>
                    <div class="muted">${product.category} ‚Ä¢ ${product.quantity} in stock</div>
                </div>
                <div>
                    <strong>${product.price.toFixed(2)} Pula</strong>
                </div>
            `;
            productElement.onclick = () => addToCart(index);
            productsList.appendChild(productElement);
        }
    });
    
    if (productsList.children.length === 0) {
        productsList.innerHTML = '<div style="text-align: center; padding: 2rem; color: var(--muted);">No products available</div>';
    }
}

function addToCart(productIndex) {
    try {
        const product = farmData.inventory[productIndex];
        if (!product) return;
        
        const existingItem = posCart.find(item => item.productIndex === productIndex);
        
        if (existingItem) {
            if (existingItem.quantity < product.quantity) {
                existingItem.quantity++;
            } else {
                alert('Not enough stock available');
                return;
            }
        } else {
            posCart.push({
                productIndex: productIndex,
                name: product.name,
                price: product.price,
                quantity: 1
            });
        }
        
        updateCartDisplay();
    } catch (error) {
        console.error('Error adding to cart:', error);
        alert('Error adding product to cart. Please try again.');
    }
}

function updateCartDisplay() {
    const cartElement = getElement('posCart');
    const totalElement = getElement('cartTotal');
    const completeBtn = getElement('completeSaleBtn');
    
    if (!cartElement || !totalElement || !completeBtn) return;
    
    if (posCart.length === 0) {
        cartElement.innerHTML = '<div style="text-align: center; padding: 2rem; color: var(--muted);">Cart is empty</div>';
        totalElement.textContent = '0.00';
        completeBtn.disabled = true;
        return;
    }
    
    let total = 0;
    cartElement.innerHTML = '';
    
    posCart.forEach((item, index) => {
        const itemTotal = item.price * item.quantity;
        total += itemTotal;
        
        const cartItem = document.createElement('div');
        cartItem.className = 'cart-item';
        cartItem.innerHTML = `
            <div>
                <strong>${item.name}</strong>
                <div class="muted">${item.price.toFixed(2)} Pula each</div>
            </div>
            <div class="quantity-controls">
                <button class="quantity-btn small" onclick="changeQuantity(${index}, -1)">-</button>
                <span style="margin: 0 0.5rem;">${item.quantity}</span>
                <button class="quantity-btn small" onclick="changeQuantity(${index}, 1)">+</button>
                <button class="quantity-btn small btn-outline" onclick="removeFromCart(${index})" style="margin-left: 0.5rem;">√ó</button>
            </div>
            <div><strong>${itemTotal.toFixed(2)} Pula</strong></div>
        `;
        cartElement.appendChild(cartItem);
    });
    
    totalElement.textContent = total.toFixed(2);
    completeBtn.disabled = false;
}

function changeQuantity(cartIndex, change) {
    try {
        const item = posCart[cartIndex];
        if (!item) return;
        
        const product = farmData.inventory[item.productIndex];
        if (!product) return;
        
        const newQuantity = item.quantity + change;
        
        if (newQuantity < 1) {
            removeFromCart(cartIndex);
            return;
        }
        
        if (newQuantity > product.quantity) {
            alert('Not enough stock available');
            return;
        }
        
        item.quantity = newQuantity;
        updateCartDisplay();
    } catch (error) {
        console.error('Error changing quantity:', error);
    }
}

function removeFromCart(cartIndex) {
    posCart.splice(cartIndex, 1);
    updateCartDisplay();
}

function clearCart() {
    posCart = [];
    updateCartDisplay();
}

function completeSale() {
    if (posCart.length === 0) return;
    
    try {
        let total = 0;
        const saleItems = [];
        
        // Update inventory and calculate total
        posCart.forEach(item => {
            const product = farmData.inventory[item.productIndex];
            if (!product) return;
            
            product.quantity -= item.quantity;
            
            const itemTotal = item.price * item.quantity;
            total += itemTotal;
            
            saleItems.push({
                name: item.name,
                quantity: item.quantity,
                price: item.price,
                total: itemTotal
            });
        });
        
        // Record sale
        const sale = {
            items: saleItems,
            total: total,
            timestamp: new Date().toISOString()
        };
        
        farmData.sales.push(sale);
        
        // Record income
        const income = {
            description: `Sale: ${saleItems.map(item => item.name).join(', ')}`,
            amount: total,
            category: 'sales',
            timestamp: new Date().toISOString()
        };
        
        farmData.finances.income.push(income);
        farmData.finances.balance += total;
        
        // Save data and reset
        saveData();
        clearCart();
        loadPOSProducts();
        loadInventory();
        loadFinanceData();
        
        alert(`Sale completed successfully! Total: ${total.toFixed(2)} Pula`);
    } catch (error) {
        console.error('Error completing sale:', error);
        alert('Error completing sale. Please try again.');
    }
}

// =============================================
// INVENTORY FUNCTIONS
// =============================================

function loadInventory() {
    const inventoryList = getElement('inventoryList');
    if (!inventoryList) return;
    
    inventoryList.innerHTML = '';
    
    // Ensure inventory array exists
    if (!farmData.inventory) {
        farmData.inventory = [];
    }
    
    farmData.inventory.forEach((item, index) => {
        const itemElement = document.createElement('div');
        let itemClass = 'inventory-item';
        
        if (item.quantity === 0) {
            itemClass += ' out-of-stock';
        } else if (item.quantity < 10) {
            itemClass += ' low-stock';
        }
        
        itemElement.className = itemClass;
        itemElement.innerHTML = `
            <h4>${item.name}</h4>
            <div class="muted">${item.category}</div>
            <div><strong>Quantity:</strong> ${item.quantity}</div>
            <div><strong>Price:</strong> ${item.price.toFixed(2)} Pula</div>
            <div><strong>Value:</strong> ${(item.quantity * item.price).toFixed(2)} Pula</div>
            <button onclick="removeProduct(${index})" class="small btn-outline" style="margin-top: 0.5rem;">Remove</button>
        `;
        inventoryList.appendChild(itemElement);
    });
    
    if (inventoryList.children.length === 0) {
        inventoryList.innerHTML = '<div style="text-align: center; padding: 2rem; color: var(--muted);">No inventory items</div>';
    }
}

function addProduct() {
    try {
        const nameInput = getElement('productName');
        const categoryInput = getElement('productCategory');
        const quantityInput = getElement('productQuantity');
        const priceInput = getElement('productPrice');
        
        if (!nameInput || !categoryInput || !quantityInput || !priceInput) {
            alert('Please fill all fields');
            return;
        }
        
        const name = nameInput.value.trim();
        const category = categoryInput.value;
        const quantity = parseInt(quantityInput.value);
        const price = parseFloat(priceInput.value);
        
        if (!name || isNaN(quantity) || quantity < 0 || isNaN(price) || price < 0) {
            alert('Please fill all fields correctly. Quantity and price cannot be negative.');
            return;
        }
        
        // Ensure inventory array exists
        if (!farmData.inventory) {
            farmData.inventory = [];
        }
        
        const newProduct = {
            name: name,
            category: category,
            quantity: quantity,
            price: price,
            added: new Date().toISOString()
        };
        
        farmData.inventory.push(newProduct);
        
        // Save and verify
        if (saveData()) {
            loadInventory();
            // Clear form
            nameInput.value = '';
            quantityInput.value = '';
            priceInput.value = '';
            alert('Product added successfully!');
        } else {
            // Remove the product if save failed
            farmData.inventory.pop();
            alert('Failed to save product. Please try again.');
        }
        
    } catch (error) {
        console.error('Error adding product:', error);
        alert('Error adding product. Please try again.');
    }
}

function removeProduct(index) {
    if (confirm('Are you sure you want to remove this product?')) {
        farmData.inventory.splice(index, 1);
        if (saveData()) {
            loadInventory();
            alert('Product removed successfully!');
        } else {
            alert('Failed to remove product. Please try again.');
        }
    }
}

// =============================================
// FINANCE FUNCTIONS
// =============================================

function loadFinanceData() {
    try {
        // Ensure finance structure exists
        if (!farmData.finances) {
            farmData.finances = {
                income: [],
                expenses: [],
                balance: 0
            };
        }
        if (!farmData.finances.income) farmData.finances.income = [];
        if (!farmData.finances.expenses) farmData.finances.expenses = [];
        if (!farmData.finances.balance) farmData.finances.balance = 0;
        
        // Calculate totals
        const totalIncome = farmData.finances.income.reduce((sum, item) => sum + item.amount, 0);
        const totalExpenses = farmData.finances.expenses.reduce((sum, item) => sum + item.amount, 0);
        const netBalance = totalIncome - totalExpenses;
        
        // Update summary safely
        const totalIncomeEl = getElement('totalIncome');
        const totalExpensesEl = getElement('totalExpenses');
        const netBalanceEl = getElement('netBalance');
        
        if (totalIncomeEl) totalIncomeEl.textContent = totalIncome.toFixed(2);
        if (totalExpensesEl) totalExpensesEl.textContent = totalExpenses.toFixed(2);
        if (netBalanceEl) netBalanceEl.textContent = netBalance.toFixed(2);
        
        // Update transaction list
        const transactionList = getElement('transactionList');
        if (!transactionList) return;
        
        transactionList.innerHTML = '';
        
        // Combine and sort transactions
        const allTransactions = [
            ...farmData.finances.income.map(t => ({...t, type: 'income'})),
            ...farmData.finances.expenses.map(t => ({...t, type: 'expense'}))
        ].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
        
        allTransactions.forEach(transaction => {
            const transactionElement = document.createElement('div');
            transactionElement.className = `transaction-item ${transaction.type}`;
            
            const date = new Date(transaction.timestamp).toLocaleDateString();
            const amount = transaction.amount.toFixed(2);
            
            transactionElement.innerHTML = `
                <div>
                    <strong>${transaction.description}</strong>
                    <div class="muted">${date} ‚Ä¢ ${transaction.category}</div>
                </div>
                <div style="font-weight: bold; color: ${transaction.type === 'income' ? 'var(--primary)' : 'var(--danger)'}">
                    ${transaction.type === 'income' ? '+' : '-'}${amount} Pula
                </div>
            `;
            
            transactionList.appendChild(transactionElement);
        });
        
        if (transactionList.children.length === 0) {
            transactionList.innerHTML = '<div style="text-align: center; padding: 2rem; color: var(--muted);">No transactions yet</div>';
        }
    } catch (error) {
        console.error('Error loading finance data:', error);
    }
}

function addIncome() {
    try {
        const descriptionInput = getElement('incomeDescription');
        const amountInput = getElement('incomeAmount');
        const categoryInput = getElement('incomeCategory');
        
        if (!descriptionInput || !amountInput || !categoryInput) {
            alert('Please fill all fields');
            return;
        }
        
        const description = descriptionInput.value.trim();
        const amount = parseFloat(amountInput.value);
        const category = categoryInput.value;
        
        if (!description || isNaN(amount) || amount <= 0) {
            alert('Please enter valid income details. Amount must be greater than 0.');
            return;
        }
        
        // Ensure finance structure exists
        if (!farmData.finances) {
            farmData.finances = {
                income: [],
                expenses: [],
                balance: 0
            };
        }
        if (!farmData.finances.income) farmData.finances.income = [];
        
        const income = {
            description: description,
            amount: amount,
            category: category,
            timestamp: new Date().toISOString()
        };
        
        farmData.finances.income.push(income);
        farmData.finances.balance += amount;
        
        if (saveData()) {
            loadFinanceData();
            // Clear form
            descriptionInput.value = '';
            amountInput.value = '';
            alert('Income added successfully!');
        } else {
            // Revert changes if save failed
            farmData.finances.income.pop();
            farmData.finances.balance -= amount;
            alert('Failed to save income. Please try again.');
        }
        
    } catch (error) {
        console.error('Error adding income:', error);
        alert('Error adding income. Please try again.');
    }
}

function addExpense() {
    try {
        const descriptionInput = getElement('expenseDescription');
        const amountInput = getElement('expenseAmount');
        const categoryInput = getElement('expenseCategory');
        
        if (!descriptionInput || !amountInput || !categoryInput) {
            alert('Please fill all fields');
            return;
        }
        
        const description = descriptionInput.value.trim();
        const amount = parseFloat(amountInput.value);
        const category = categoryInput.value;
        
        if (!description || isNaN(amount) || amount <= 0) {
            alert('Please enter valid expense details. Amount must be greater than 0.');
            return;
        }
        
        // Ensure finance structure exists
        if (!farmData.finances) {
            farmData.finances = {
                income: [],
                expenses: [],
                balance: 0
            };
        }
        if (!farmData.finances.expenses) farmData.finances.expenses = [];
        
        const expense = {
            description: description,
            amount: amount,
            category: category,
            timestamp: new Date().toISOString()
        };
        
        farmData.finances.expenses.push(expense);
        farmData.finances.balance -= amount;
        
        if (saveData()) {
            loadFinanceData();
            // Clear form
            descriptionInput.value = '';
            amountInput.value = '';
            alert('Expense added successfully!');
        } else {
            // Revert changes if save failed
            farmData.finances.expenses.pop();
            farmData.finances.balance += amount;
            alert('Failed to save expense. Please try again.');
        }
        
    } catch (error) {
        console.error('Error adding expense:', error);
        alert('Error adding expense. Please try again.');
    }
}

// =============================================
// CROP DATABASE
// =============================================

// =============================================
// COMPREHENSIVE CROP DATABASE (30+ CROPS)
// =============================================

const cropDatabase = {
    // CEREALS (6 crops)
    maize: {
        name: "Maize",
        type: "Cereal",
        growthTime: "90-120 days",
        yield: "3-8 tons/ha",
        season: "Nov-Jan (Summer)",
        price: "5-8 Pula/kg",
        water: "Medium",
        soil: "Well-drained loamy",
        pests: ["Fall Armyworm", "Stem Borer", "Aphids", "Termites"],
        diseases: ["Maize Streak Virus", "Grey Leaf Spot", "Rust", "Leaf Blight"],
        chemicals: ["Emamectin Benzoate", "Chlorantraniliprole", "Lambda-cyhalothrin", "Mancozeb"],
        fertilizers: ["NPK 8:24:24", "Urea", "CAN"],
        description: "Staple food crop, requires good soil fertility and regular weeding.",
        careStages: [
            {
                stage: "Land Preparation",
                duration: "1-2 weeks",
                tasks: ["Plough field deeply", "Apply basal fertilizer", "Create planting rows"]
            },
            {
                stage: "Germination",
                duration: "7-10 days",
                tasks: ["Plant seeds 3-5cm deep", "Ensure adequate moisture", "Monitor emergence"]
            },
            {
                stage: "Vegetative Growth",
                duration: "30-45 days",
                tasks: ["Apply top dressing", "Control weeds", "Monitor for pests", "Thin if necessary"]
            },
            {
                stage: "Flowering",
                duration: "10-14 days",
                tasks: ["Ensure adequate water", "Monitor pollination", "Control diseases", "Apply foliar feed"]
            },
            {
                stage: "Grain Filling",
                duration: "30-40 days",
                tasks: ["Reduce water gradually", "Monitor for pests", "Prepare for harvest", "Check maturity"]
            }
        ]
    },

    sorghum: {
        name: "Sorghum",
        type: "Cereal",
        growthTime: "90-120 days",
        yield: "2-5 tons/ha",
        season: "Nov-Jan (Summer)",
        price: "4-7 Pula/kg",
        water: "Low",
        soil: "Various, tolerates poor soils",
        pests: ["Shoot Fly", "Stem Borer", "Aphids", "Head Caterpillar"],
        diseases: ["Anthracnose", "Grain Mold", "Downy Mildew", "Rust"],
        chemicals: ["Imidacloprid", "Carbaryl", "Mancozeb", "Carbendazim"],
        fertilizers: ["NPK 10:20:10", "Urea"],
        description: "Drought-tolerant cereal, good for semi-arid regions.",
        careStages: [
            {
                stage: "Germination",
                duration: "5-7 days",
                tasks: ["Prepare seedbed", "Plant seeds 2-3cm deep", "Light watering"]
            },
            {
                stage: "Vegetative",
                duration: "30-40 days",
                tasks: ["Thin seedlings", "Apply nitrogen", "Weed control", "Monitor growth"]
            },
            {
                stage: "Reproductive",
                duration: "35-45 days",
                tasks: ["Monitor moisture", "Pest control", "Disease management", "Bird scaring"]
            },
            {
                stage: "Maturity",
                duration: "20-30 days",
                tasks: ["Reduce irrigation", "Monitor birds", "Harvest preparation", "Test grain hardness"]
            }
        ]
    },

    millet: {
        name: "Millet",
        type: "Cereal",
        growthTime: "75-90 days",
        yield: "1-3 tons/ha",
        season: "Nov-Jan (Summer)",
        price: "6-10 Pula/kg",
        water: "Very Low",
        soil: "Sandy to loamy",
        pests: ["Millet Head Miner", "Stem Borer", "Birds"],
        diseases: ["Downy Mildew", "Smut", "Rust"],
        chemicals: ["Carbaryl", "Mancozeb", "Metalaxyl"],
        fertilizers: ["NPK 12:24:12", "Compost"],
        description: "Highly drought-resistant, grows in poor soils with minimal inputs.",
        careStages: [
            {
                stage: "Planting",
                duration: "1 week",
                tasks: ["Broadcast seeds", "Light covering", "Initial watering"]
            },
            {
                stage: "Vegetative",
                duration: "30-40 days",
                tasks: ["Thin plants", "Light weeding", "Monitor growth"]
            },
            {
                stage: "Flowering",
                duration: "20-25 days",
                tasks: ["Bird control", "Pest monitoring", "Minimal watering"]
            },
            {
                stage: "Maturity",
                duration: "15-20 days",
                tasks: ["Harvest when golden", "Thresh grains", "Dry properly"]
            }
        ]
    },

    wheat: {
        name: "Wheat",
        type: "Cereal",
        growthTime: "120-150 days",
        yield: "3-6 tons/ha",
        season: "May-Jul (Winter)",
        price: "7-12 Pula/kg",
        water: "Medium",
        soil: "Well-drained clay loam",
        pests: ["Aphids", "Armyworm", "Stem Sawfly"],
        diseases: ["Rust", "Septoria", "Powdery Mildew", "Fusarium"],
        chemicals: ["Triadimefon", "Propiconazole", "Lambda-cyhalothrin"],
        fertilizers: ["NPK 15:15:15", "Urea", "Ammonium nitrate"],
        description: "Winter cereal requiring cool temperatures for good development.",
        careStages: [
            {
                stage: "Planting",
                duration: "1-2 weeks",
                tasks: ["Prepare fine seedbed", "Drill seeds 2-3cm deep", "Apply basal fertilizer"]
            },
            {
                stage: "Tillering",
                duration: "40-50 days",
                tasks: ["Apply nitrogen", "Weed control", "Monitor diseases"]
            },
            {
                stage: "Stem Extension",
                duration: "30-40 days",
                tasks: ["Ensure adequate moisture", "Pest control", "Support growth"]
            },
            {
                stage: "Ripening",
                duration: "30-40 days",
                tasks: ["Stop irrigation", "Monitor maturity", "Harvest when golden"]
            }
        ]
    },

    barley: {
        name: "Barley",
        type: "Cereal",
        growthTime: "110-130 days",
        yield: "2-5 tons/ha",
        season: "May-Jul (Winter)",
        price: "6-9 Pula/kg",
        water: "Low-Medium",
        soil: "Various, tolerates salinity",
        pests: ["Aphids", "Armyworm", "Wireworms"],
        diseases: ["Net Blotch", "Scald", "Rust", "Smut"],
        chemicals: ["Carbendazim", "Propiconazole", "Deltamethrin"],
        fertilizers: ["NPK 12:24:12", "Urea"],
        description: "Winter cereal used for malt and animal feed, tolerates marginal soils.",
        careStages: [
            {
                stage: "Establishment",
                duration: "2-3 weeks",
                tasks: ["Plant in cool weather", "Apply starter fertilizer", "Ensure good seed-soil contact"]
            },
            {
                stage: "Tillering",
                duration: "40-50 days",
                tasks: ["Apply nitrogen", "Control weeds", "Monitor growth"]
            },
            {
                stage: "Grain Fill",
                duration: "40-50 days",
                tasks: ["Manage water", "Disease control", "Monitor quality"]
            },
            {
                stage: "Harvest",
                duration: "1-2 weeks",
                tasks: ["Harvest at 14% moisture", "Dry properly", "Store in cool conditions"]
            }
        ]
    },

    oats: {
        name: "Oats",
        type: "Cereal",
        growthTime: "100-120 days",
        yield: "2-4 tons/ha",
        season: "May-Jul (Winter)",
        price: "5-8 Pula/kg",
        water: "Medium",
        soil: "Moist, fertile soils",
        pests: ["Aphids", "Armyworm", "Wireworms"],
        diseases: ["Crown Rust", "Stem Rust", "Septoria"],
        chemicals: ["Propiconazole", "Cyproconazole", "Lambda-cyhalothrin"],
        fertilizers: ["NPK 10:20:10", "Urea"],
        description: "Winter cereal good for forage and grain, prefers cool moist conditions.",
        careStages: [
            {
                stage: "Planting",
                duration: "1-2 weeks",
                tasks: ["Prepare seedbed", "Drill seeds", "Apply fertilizer"]
            },
            {
                stage: "Vegetative",
                duration: "50-60 days",
                tasks: ["Monitor growth", "Weed control", "Pest management"]
            },
            {
                stage: "Reproductive",
                duration: "30-40 days",
                tasks: ["Ensure moisture", "Disease control", "Monitor development"]
            },
            {
                stage: "Maturity",
                duration: "15-20 days",
                tasks: ["Harvest for grain or forage", "Dry properly", "Store appropriately"]
            }
        ]
    },

    // OILSEEDS (5 crops)
    safflower: {
        name: "Safflower",
        type: "Oilseed",
        growthTime: "120-150 days",
        yield: "1-2 tons/ha (seeds)",
        season: "May-Jul (Winter)",
        price: "15-25 Pula/kg (seeds)",
        water: "Low",
        soil: "Deep, well-drained soils",
        pests: ["Aphids", "Safflower Fly", "Thrips"],
        diseases: ["Fusarium Wilt", "Alternaria Leaf Spot", "Rust"],
        chemicals: ["Imidacloprid", "Cypermethrin", "Mancozeb", "Carbendazim"],
        fertilizers: ["NPK 20:20:20", "Superphosphate"],
        description: "Drought-tolerant oilseed with high-quality oil for cooking and industrial use.",
        careStages: [
            {
                stage: "Germination",
                duration: "10-14 days",
                tasks: ["Prepare sandy loam soil", "Plant seeds 2-3cm deep", "Light irrigation"]
            },
            {
                stage: "Rosette Stage",
                duration: "30-40 days",
                tasks: ["Thin plants to 15cm apart", "Control weeds", "Apply phosphorus fertilizer"]
            },
            {
                stage: "Stem Elongation",
                duration: "20-30 days",
                tasks: ["Monitor water needs", "Support plants if needed", "Control pests"]
            },
            {
                stage: "Flowering & Seed Development",
                duration: "40-50 days",
                tasks: ["Reduce irrigation", "Monitor for diseases", "Prepare for harvest"]
            }
        ]
    },

    sunflower: {
        name: "Sunflower",
        type: "Oilseed",
        growthTime: "100-120 days",
        yield: "1-3 tons/ha",
        season: "Jan-Mar (Summer)",
        price: "12-18 Pula/kg",
        water: "Medium",
        soil: "Various, well-drained",
        pests: ["Sunflower Moth", "Aphids", "Cutworms", "Birds"],
        diseases: ["Downy Mildew", "Rust", "Sclerotinia", "Verticillium Wilt"],
        chemicals: ["Deltamethrin", "Carbendazim", "Metalaxyl", "Azoxystrobin"],
        fertilizers: ["NPK 12:24:12", "Boron"],
        description: "Popular oilseed crop with high oil content, requires good sunlight.",
        careStages: [
            {
                stage: "Germination",
                duration: "7-10 days",
                tasks: ["Prepare fine seedbed", "Plant 2-3cm deep", "Light irrigation"]
            },
            {
                stage: "Vegetative",
                duration: "30-40 days",
                tasks: ["Thin to 45cm spacing", "Apply fertilizer", "Weed control", "Monitor growth"]
            },
            {
                stage: "Flowering",
                duration: "20-30 days",
                tasks: ["Monitor pollinators", "Pest control", "Adequate water", "Support if windy"]
            },
            {
                stage: "Maturity",
                duration: "30-40 days",
                tasks: ["Monitor bird damage", "Harvest timing", "Dry properly", "Store in dry conditions"]
            }
        ]
    },

    groundnut: {
        name: "Groundnuts",
        type: "Oilseed",
        growthTime: "100-130 days",
        yield: "1-3 tons/ha (pods)",
        season: "Nov-Jan (Summer)",
        price: "18-25 Pula/kg",
        water: "Medium",
        soil: "Sandy loam, well-drained",
        pests: ["Aphids", "Termites", "White Grubs", "Leaf Miner"],
        diseases: ["Early Leaf Spot", "Late Leaf Spot", "Rosette Virus", "Stem Rot"],
        chemicals: ["Chlorothalonil", "Carbendazim", "Imidacloprid", "Lambda-cyhalothrin"],
        fertilizers: ["NPK 12:24:12", "Gypsum", "Boron"],
        description: "Legume oilseed that fixes nitrogen, requires careful harvesting.",
        careStages: [
            {
                stage: "Planting",
                duration: "1-2 weeks",
                tasks: ["Shell seeds before planting", "Plant 5cm deep", "Inoculate with rhizobium"]
            },
            {
                stage: "Vegetative",
                duration: "40-50 days",
                tasks: ["Weed control", "Monitor pests", "Light irrigation", "Apply calcium"]
            },
            {
                stage: "Pegging",
                duration: "30-40 days",
                tasks: ["Ensure loose soil", "Avoid water stress", "Disease control", "Monitor development"]
            },
            {
                stage: "Maturity",
                duration: "20-30 days",
                tasks: ["Stop irrigation", "Check pod maturity", "Lift plants carefully", "Dry properly"]
            }
        ]
    },

    soybeans: {
        name: "Soybeans",
        type: "Oilseed",
        growthTime: "90-120 days",
        yield: "2-4 tons/ha",
        season: "Nov-Jan (Summer)",
        price: "10-15 Pula/kg",
        water: "Medium",
        soil: "Well-drained loams",
        pests: ["Bean Leaf Beetle", "Aphids", "Stink Bugs", "Caterpillars"],
        diseases: ["Soybean Rust", "Bacterial Blight", "Root Rot", "Mosaic Virus"],
        chemicals: ["Azoxystrobin", "Cypermethrin", "Imidacloprid", "Mancozeb"],
        fertilizers: ["NPK 10:20:10", "Inoculant", "Molybdenum"],
        description: "High-protein oilseed, fixes nitrogen, multiple market uses.",
        careStages: [
            {
                stage: "Planting",
                duration: "1-2 weeks",
                tasks: ["Inoculate seeds", "Plant 2-3cm deep", "Apply starter fertilizer"]
            },
            {
                stage: "Vegetative",
                duration: "40-50 days",
                tasks: ["Weed control", "Monitor growth", "Pest scouting", "Ensure nodulation"]
            },
            {
                stage: "Reproductive",
                duration: "30-40 days",
                tasks: ["Adequate moisture", "Disease control", "Monitor pod set", "Avoid stress"]
            },
            {
                stage: "Maturity",
                duration: "15-20 days",
                tasks: ["Stop irrigation", "Harvest at 13% moisture", "Combine carefully", "Store properly"]
            }
        ]
    },

    canola: {
        name: "Canola",
        type: "Oilseed",
        growthTime: "110-140 days",
        yield: "2-4 tons/ha",
        season: "May-Jul (Winter)",
        price: "14-20 Pula/kg",
        water: "Medium",
        soil: "Well-drained, fertile",
        pests: ["Flea Beetle", "Aphids", "Diamondback Moth"],
        diseases: ["Blackleg", "Sclerotinia", "Clubroot", "Alternaria"],
        chemicals: ["Lambda-cyhalothrin", "Carbendazim", "Propiconazole"],
        fertilizers: ["NPK 15:15:15", "Boron", "Sulfur"],
        description: "High-quality oilseed for cooking oil and biodiesel production.",
        careStages: [
            {
                stage: "Establishment",
                duration: "2-3 weeks",
                tasks: ["Prepare fine seedbed", "Shallow planting", "Apply fertilizer"]
            },
            {
                stage: "Rosette",
                duration: "50-60 days",
                tasks: ["Weed control", "Pest management", "Monitor growth", "Frost protection"]
            },
            {
                stage: "Flowering",
                duration: "30-40 days",
                tasks: ["Ensure pollination", "Disease control", "Monitor pod development"]
            },
            {
                stage: "Maturity",
                duration: "20-30 days",
                tasks: ["Swath or direct harvest", "Dry to 8% moisture", "Store carefully"]
            }
        ]
    },

    // VEGETABLES (8 crops)
    tomatoes: {
        name: "Tomatoes",
        type: "Vegetable",
        growthTime: "70-90 days",
        yield: "20-40 tons/ha",
        season: "Year-round (avoid frost)",
        price: "8-15 Pula/kg",
        water: "High",
        soil: "Well-drained, rich in organic matter",
        pests: ["Tuta absoluta", "Whitefly", "Aphids", "Fruit Borer"],
        diseases: ["Early Blight", "Late Blight", "Bacterial Wilt", "Blossom End Rot"],
        chemicals: ["Chlorantraniliprole", "Copper fungicides", "Mancozeb", "Spinosad"],
        fertilizers: ["NPK 15:15:15", "Calcium nitrate", "Compost"],
        description: "High-value vegetable with continuous demand, requires careful management.",
        careStages: [
            {
                stage: "Nursery",
                duration: "3-4 weeks",
                tasks: ["Seed sowing in trays", "Temperature control", "Transplant preparation", "Hardening off"]
            },
            {
                stage: "Field Establishment",
                duration: "2-3 weeks",
                tasks: ["Transplanting", "Staking", "Initial watering", "Shade protection"]
            },
            {
                stage: "Vegetative Growth",
                duration: "3-4 weeks",
                tasks: ["Training plants", "Fertilization", "Weed control", "Pest monitoring"]
            },
            {
                stage: "Production",
                duration: "6-8 weeks",
                tasks: ["Regular harvest", "Pest control", "Fertilization", "Quality management"]
            }
        ]
    },

    cabbage: {
        name: "Cabbage",
        type: "Vegetable",
        growthTime: "80-120 days",
        yield: "20-40 tons/ha",
        season: "Year-round (cool seasons)",
        price: "6-12 Pula/head",
        water: "High",
        soil: "Fertile, moisture-retentive",
        pests: ["Diamondback Moth", "Aphids", "Cutworms", "Cabbage Looper"],
        diseases: ["Black Rot", "Clubroot", "Downy Mildew", "Alternaria"],
        chemicals: ["Bacillus thuringiensis", "Spinosad", "Chlorothalonil", "Metalaxyl"],
        fertilizers: ["NPK 10:20:10", "Compost", "Borax"],
        description: "Popular leafy vegetable, requires consistent moisture and fertility.",
        careStages: [
            {
                stage: "Nursery",
                duration: "4-5 weeks",
                tasks: ["Seed sowing", "Temperature control", "Transplant preparation", "Pest protection"]
            },
            {
                stage: "Transplanting",
                duration: "1-2 weeks",
                tasks: ["Transplant seedlings", "Water thoroughly", "Shade protection", "Spacing 45x45cm"]
            },
            {
                stage: "Head Formation",
                duration: "6-8 weeks",
                tasks: ["Regular irrigation", "Fertilize", "Pest control", "Weed management"]
            },
            {
                stage: "Maturity",
                duration: "1-2 weeks",
                tasks: ["Monitor head firmness", "Harvest", "Post-harvest cooling", "Quality grading"]
            }
        ]
    },

    onions: {
        name: "Onions",
        type: "Vegetable",
        growthTime: "120-150 days",
        yield: "15-30 tons/ha",
        season: "Mar-May (Autumn)",
        price: "8-15 Pula/kg",
        water: "Medium",
        soil: "Light, well-drained",
        pests: ["Thrips", "Onion Fly", "Cutworms"],
        diseases: ["Purple Blotch", "Downy Mildew", "Neck Rot", "White Rot"],
        chemicals: ["Spinosad", "Chlorothalonil", "Metalaxyl", "Carbendazim"],
        fertilizers: ["NPK 15:15:15", "Sulfur", "Compost"],
        description: "Bulb vegetable requiring long growing season and careful curing.",
        careStages: [
            {
                stage: "Nursery/Planting",
                duration: "6-8 weeks",
                tasks: ["Start seeds or sets", "Transplant when ready", "Space properly"]
            },
            {
                stage: "Vegetative",
                duration: "60-70 days",
                tasks: ["Weed control", "Regular watering", "Fertilize", "Monitor growth"]
            },
            {
                stage: "Bulb Formation",
                duration: "40-50 days",
                tasks: ["Reduce watering", "Monitor maturity", "Pest control", "Support bulbs"]
            },
            {
                stage: "Maturity & Curing",
                duration: "2-3 weeks",
                tasks: ["Stop watering", "Lift bulbs", "Cure properly", "Store in dry conditions"]
            }
        ]
    },

    carrots: {
        name: "Carrots",
        type: "Vegetable",
        growthTime: "70-100 days",
        yield: "20-40 tons/ha",
        season: "Year-round (cool weather)",
        price: "10-18 Pula/kg",
        water: "Medium",
        soil: "Deep, stone-free sandy loam",
        pests: ["Carrot Fly", "Aphids", "Cutworms"],
        diseases: ["Alternaria", "Powdery Mildew", "Cavity Spot"],
        chemicals: ["Cypermethrin", "Chlorothalonil", "Sulfur"],
        fertilizers: ["NPK 8:24:24", "Compost", "Potassium"],
        description: "Root vegetable requiring deep, loose soil for straight roots.",
        careStages: [
            {
                stage: "Land Preparation",
                duration: "1-2 weeks",
                tasks: ["Deep ploughing", "Remove stones", "Prepare fine tilth", "Form raised beds"]
            },
            {
                stage: "Sowing",
                duration: "1-2 weeks",
                tasks: ["Sow seeds shallow", "Keep moist", "Thin seedlings", "Weed control"]
            },
            {
                stage: "Root Development",
                duration: "50-70 days",
                tasks: ["Regular watering", "Monitor growth", "Pest control", "Side dress fertilizer"]
            },
            {
                stage: "Maturity",
                duration: "1-2 weeks",
                tasks: ["Check root size", "Harvest carefully", "Wash and grade", "Cool storage"]
            }
        ]
    },

    spinach: {
        name: "Spinach",
        type: "Vegetable",
        growthTime: "40-50 days",
        yield: "10-20 tons/ha",
        season: "Year-round (cool seasons)",
        price: "12-20 Pula/kg",
        water: "High",
        soil: "Fertile, well-drained",
        pests: ["Aphids", "Leaf Miner", "Caterpillars"],
        diseases: ["Downy Mildew", "White Rust", "Leaf Spot"],
        chemicals: ["Spinosad", "Metalaxyl", "Chlorothalonil"],
        fertilizers: ["NPK 15:15:15", "Nitrogen", "Compost"],
        description: "Fast-growing leafy green, multiple harvests possible.",
        careStages: [
            {
                stage: "Sowing",
                duration: "1 week",
                tasks: ["Direct sowing", "Thin seedlings", "Keep moist", "Weed control"]
            },
            {
                stage: "Vegetative",
                duration: "25-30 days",
                tasks: ["Regular watering", "Fertilize", "Pest control", "Monitor growth"]
            },
            {
                stage: "Harvest",
                duration: "10-15 days",
                tasks: ["Cut leaves", "Multiple harvests", "Cool immediately", "Quality control"]
            }
        ]
    },

    peppers: {
        name: "Bell Peppers",
        type: "Vegetable",
        growthTime: "80-100 days",
        yield: "15-30 tons/ha",
        season: "Year-round (warm conditions)",
        price: "15-25 Pula/kg",
        water: "Medium",
        soil: "Well-drained, fertile",
        pests: ["Aphids", "Thrips", "Fruit Borer", "Whitefly"],
        diseases: ["Bacterial Spot", "Powdery Mildew", "Phytophthora", "Blossom End Rot"],
        chemicals: ["Copper fungicides", "Spinosad", "Imidacloprid", "Mancozeb"],
        fertilizers: ["NPK 15:15:15", "Calcium", "Compost"],
        description: "Colorful fruit vegetable, requires warm temperatures and careful handling.",
        careStages: [
            {
                stage: "Nursery",
                duration: "6-8 weeks",
                tasks: ["Start seeds indoors", "Maintain warmth", "Transplant preparation"]
            },
            {
                stage: "Field Establishment",
                duration: "2-3 weeks",
                tasks: ["Transplant", "Staking", "Initial care", "Shade protection"]
            },
            {
                stage: "Flowering & Fruiting",
                duration: "50-60 days",
                tasks: ["Pollination support", "Regular harvest", "Pest control", "Quality management"]
            }
        ]
    },

    lettuce: {
        name: "Lettuce",
        type: "Vegetable",
        growthTime: "50-70 days",
        yield: "15-25 tons/ha",
        season: "Year-round (cool weather)",
        price: "10-18 Pula/head",
        water: "High",
        soil: "Fertile, organic-rich",
        pests: ["Aphids", "Slugs", "Caterpillars"],
        diseases: ["Bottom Rot", "Downy Mildew", "Tip Burn"],
        chemicals: ["Spinosad", "Metalaxyl", "Pyrethrin"],
        fertilizers: ["NPK 10:10:10", "Nitrogen", "Compost"],
        description: "Leafy salad vegetable, requires consistent moisture and cool conditions.",
        careStages: [
            {
                stage: "Sowing/Transplanting",
                duration: "3-4 weeks",
                tasks: ["Start seeds or transplant", "Space properly", "Keep moist"]
            },
            {
                stage: "Head Formation",
                duration: "30-40 days",
                tasks: ["Regular watering", "Fertilize", "Weed control", "Pest management"]
            },
            {
                stage: "Maturity",
                duration: "1 week",
                tasks: ["Harvest in morning", "Cool immediately", "Package carefully", "Store at 0¬∞C"]
            }
        ]
    },

    green_beans: {
        name: "Green Beans",
        type: "Vegetable",
        growthTime: "50-70 days",
        yield: "8-15 tons/ha",
        season: "Year-round (warm weather)",
        price: "12-20 Pula/kg",
        water: "Medium",
        soil: "Well-drained, fertile",
        pests: ["Bean Beetle", "Aphids", "Thrips"],
        diseases: ["Rust", "Anthracnose", "Bacterial Blight"],
        chemicals: ["Cypermethrin", "Mancozeb", "Copper fungicides"],
        fertilizers: ["NPK 10:20:10", "Compost", "Inoculant"],
        description: "Fast-growing legume vegetable, multiple pickings possible.",
        careStages: [
            {
                stage: "Planting",
                duration: "1 week",
                tasks: ["Direct sowing", "Inoculate seeds", "Space properly"]
            },
            {
                stage: "Vegetative",
                duration: "30-40 days",
                tasks: ["Support climbing types", "Weed control", "Pest monitoring"]
            },
            {
                stage: "Harvest",
                duration: "20-30 days",
                tasks: ["Pick regularly", "Handle carefully", "Cool quickly", "Multiple harvests"]
            }
        ]
    },

    // TUBERS & ROOTS (4 crops)
    potatoes: {
        name: "Potatoes",
        type: "Tuber",
        growthTime: "90-120 days",
        yield: "15-30 tons/ha",
        season: "Feb-Apr (Autumn)",
        price: "8-15 Pula/kg",
        water: "High",
        soil: "Well-drained, loose",
        pests: ["Potato Tuber Moth", "Aphids", "Cutworms", "Wireworms"],
        diseases: ["Late Blight", "Early Blight", "Bacterial Wilt", "Scab"],
        chemicals: ["Mancozeb", "Chlorothalonil", "Imidacloprid", "Metalaxyl"],
        fertilizers: ["NPK 15:15:15", "Potassium", "Compost"],
        description: "Staple food crop requiring careful water and disease management.",
        careStages: [
            {
                stage: "Planting",
                duration: "2-3 weeks",
                tasks: ["Prepare ridges", "Plant seed potatoes", "Initial watering", "Apply fertilizer"]
            },
            {
                stage: "Vegetative",
                duration: "4-5 weeks",
                tasks: ["Earth up plants", "Weed control", "Fertilize", "Pest control"]
            },
            {
                stage: "Tuber Formation",
                duration: "6-8 weeks",
                tasks: ["Maintain soil moisture", "Disease control", "Monitor growth", "Avoid compaction"]
            },
            {
                stage: "Maturity",
                duration: "2-3 weeks",
                tasks: ["Stop irrigation", "Harvest", "Cure potatoes", "Store in dark, cool place"]
            }
        ]
    },

    sweet_potatoes: {
        name: "Sweet Potatoes",
        type: "Tuber",
        growthTime: "100-140 days",
        yield: "10-20 tons/ha",
        season: "Nov-Jan (Summer)",
        price: "7-12 Pula/kg",
        water: "Medium",
        soil: "Sandy loam, well-drained",
        pests: ["Sweet Potato Weevil", "Cutworms", "Nematodes"],
        diseases: ["Black Rot", "Soft Rot", "Foot Rot"],
        chemicals: ["Carbaryl", "Mancozeb", "Nematicides"],
        fertilizers: ["NPK 8:24:24", "Potassium", "Compost"],
        description: "Nutritious root crop, drought-tolerant once established.",
        careStages: [
            {
                stage: "Vine Planting",
                duration: "1-2 weeks",
                tasks: ["Plant vine cuttings", "Space properly", "Initial watering"]
            },
            {
                stage: "Vine Growth",
                duration: "60-80 days",
                tasks: ["Weed control", "Train vines", "Monitor pests", "Light fertilization"]
            },
            {
                stage: "Tuber Development",
                duration: "40-50 days",
                tasks: ["Avoid excess water", "Monitor growth", "Pest control"]
            },
            {
                stage: "Harvest",
                duration: "1-2 weeks",
                tasks: ["Dig carefully", "Cure for 10 days", "Store in warm, dry place"]
            }
        ]
    },

    cassava: {
        name: "Cassava",
        type: "Tuber",
        growthTime: "8-24 months",
        yield: "15-40 tons/ha",
        season: "Year-round",
        price: "4-8 Pula/kg",
        water: "Low",
        soil: "Various, well-drained",
        pests: ["Mealybug", "Green Mite", "Scale Insects"],
        diseases: ["Cassava Mosaic", "Brown Streak", "Bacterial Blight"],
        chemicals: ["Systemic insecticides", "Miticides", "Fungicides"],
        fertilizers: ["NPK 12:24:12", "Potassium", "Organic matter"],
        description: "Drought-tolerant staple crop, long growing season required.",
        careStages: [
            {
                stage: "Planting",
                duration: "1-2 weeks",
                tasks: ["Plant stem cuttings", "Space widely", "Initial care"]
            },
            {
                stage: "Establishment",
                duration: "3-4 months",
                tasks: ["Weed control", "Pest monitoring", "Light fertilization"]
            },
            {
                stage: "Bulking",
                duration: "6-18 months",
                tasks: ["Minimal care", "Monitor diseases", "Occasional weeding"]
            },
            {
                stage: "Harvest",
                duration: "Variable",
                tasks: ["Harvest as needed", "Process quickly", "Store properly"]
            }
        ]
    },

    beetroot: {
        name: "Beetroot",
        type: "Root",
        growthTime: "60-80 days",
        yield: "20-35 tons/ha",
        season: "Year-round (cool weather)",
        price: "10-16 Pula/kg",
        water: "Medium",
        soil: "Deep, stone-free",
        pests: ["Leaf Miner", "Aphids", "Flea Beetle"],
        diseases: ["Cercospora", "Downy Mildew", "Root Rot"],
        chemicals: ["Spinosad", "Mancozeb", "Metalaxyl"],
        fertilizers: ["NPK 10:20:10", "Boron", "Compost"],
        description: "Colorful root vegetable, both roots and leaves are edible.",
        careStages: [
            {
                stage: "Sowing",
                duration: "1-2 weeks",
                tasks: ["Direct sowing", "Thin seedlings", "Keep moist"]
            },
            {
                stage: "Root Development",
                duration: "40-50 days",
                tasks: ["Regular watering", "Weed control", "Monitor growth"]
            },
            {
                stage: "Maturity",
                duration: "10-15 days",
                tasks: ["Check root size", "Harvest", "Remove tops", "Store cool"]
            }
        ]
    },

    // LEGUMES (4 crops)
    beans: {
        name: "Dry Beans",
        type: "Legume",
        growthTime: "70-90 days",
        yield: "1-2 tons/ha",
        season: "Oct-Dec (Summer)",
        price: "10-15 Pula/kg",
        water: "Medium",
        soil: "Well-drained, fertile",
        pests: ["Bean Fly", "Aphids", "Whiteflies", "Bean Bruchid"],
        diseases: ["Bean Rust", "Anthracnose", "Bacterial Blight", "Root Rot"],
        chemicals: ["Lambda-cyhalothrin", "Mancozeb", "Copper-based fungicides", "Malathion"],
        fertilizers: ["NPK 10:20:10", "Inoculant", "Molybdenum"],
        description: "Nutritious legume that improves soil fertility through nitrogen fixation.",
        careStages: [
            {
                stage: "Germination",
                duration: "7-10 days",
                tasks: ["Inoculate seeds", "Plant in moist soil", "Ensure good drainage", "Protect from birds"]
            },
            {
                stage: "Vegetative",
                duration: "25-35 days",
                tasks: ["Support climbing varieties", "Weed control", "Monitor growth", "Pest scouting"]
            },
            {
                stage: "Flowering",
                duration: "15-20 days",
                tasks: ["Ensure pollination", "Pest monitoring", "Adequate water", "Disease control"]
            },
            {
                stage: "Pod Development",
                duration: "20-25 days",
                tasks: ["Regular harvest", "Quality control", "Post-harvest handling", "Dry to 14% moisture"]
            }
        ]
    },

    cowpeas: {
        name: "Cowpeas",
        type: "Legume",
        growthTime: "60-90 days",
        yield: "1-3 tons/ha",
        season: "Nov-Jan (Summer)",
        price: "8-12 Pula/kg",
        water: "Low",
        soil: "Various, well-drained",
        pests: ["Aphids", "Thrips", "Pod Borer", "Bruchids"],
        diseases: ["Bacterial Blight", "Powdery Mildew", "Cowpea Mosaic"],
        chemicals: ["Dimethoate", "Mancozeb", "Carbendazim"],
        fertilizers: ["NPK 10:20:10", "Inoculant", "Phosphorus"],
        description: "Drought-tolerant legume, both grains and leaves are edible.",
        careStages: [
            {
                stage: "Planting",
                duration: "1 week",
                tasks: ["Direct sowing", "Inoculate seeds", "Space properly"]
            },
            {
                stage: "Vegetative",
                duration: "30-40 days",
                tasks: ["Weed control", "Monitor pests", "Support if needed"]
            },
            {
                stage: "Podding",
                duration: "25-35 days",
                tasks: ["Harvest young pods", "Monitor maturity", "Pest control"]
            },
            {
                stage: "Harvest",
                duration: "1-2 weeks",
                tasks: ["Harvest dry grains", "Thresh", "Dry properly", "Store safely"]
            }
        ]
    },

    peas: {
        name: "Garden Peas",
        type: "Legume",
        growthTime: "60-80 days",
        yield: "3-6 tons/ha (pods)",
        season: "May-Jul (Winter)",
        price: "15-25 Pula/kg",
        water: "Medium",
        soil: "Cool, well-drained",
        pests: ["Aphids", "Pea Moth", "Thrips"],
        diseases: ["Powdery Mildew", "Fusarium Wilt", "Root Rot"],
        chemicals: ["Pirimicarb", "Sulfur", "Carbendazim"],
        fertilizers: ["NPK 10:20:10", "Inoculant", "Compost"],
        description: "Cool-season legume, requires support and careful harvesting.",
        careStages: [
            {
                stage: "Planting",
                duration: "1-2 weeks",
                tasks: ["Direct sowing", "Provide support", "Inoculate seeds"]
            },
            {
                stage: "Vegetative",
                duration: "30-40 days",
                tasks: ["Train vines", "Weed control", "Monitor growth"]
            },
            {
                stage: "Podding",
                duration: "20-30 days",
                tasks: ["Harvest regularly", "Handle carefully", "Cool immediately"]
            }
        ]
    },

    lentils: {
        name: "Lentils",
        type: "Legume",
        growthTime: "80-110 days",
        yield: "1-2 tons/ha",
        season: "May-Jul (Winter)",
        price: "20-30 Pula/kg",
        water: "Low",
        soil: "Well-drained, various",
        pests: ["Aphids", "Lygus Bugs", "Wireworms"],
        diseases: ["Ascochyta Blight", "Anthracnose", "Root Rot"],
        chemicals: ["Cypermethrin", "Carbendazim", "Mancozeb"],
        fertilizers: ["NPK 10:20:10", "Inoculant", "Sulfur"],
        description: "High-protein legume, drought-tolerant once established.",
        careStages: [
            {
                stage: "Planting",
                duration: "1-2 weeks",
                tasks: ["Early sowing", "Inoculate seeds", "Shallow planting"]
            },
            {
                stage: "Vegetative",
                duration: "50-60 days",
                tasks: ["Weed control", "Monitor growth", "Pest management"]
            },
            {
                stage: "Maturity",
                duration: "20-30 days",
                tasks: ["Harvest when plants yellow", "Combine carefully", "Dry to 14% moisture"]
            }
        ]
    },

    // FRUITS (3 crops)
    watermelon: {
        name: "Watermelon",
        type: "Fruit",
        growthTime: "80-100 days",
        yield: "20-40 tons/ha",
        season: "Aug-Oct (Spring)",
        price: "6-12 Pula/kg",
        water: "High",
        soil: "Sandy, well-drained",
        pests: ["Aphids", "Fruit Fly", "Spider Mites"],
        diseases: ["Fusarium Wilt", "Anthracnose", "Gummy Stem Blight"],
        chemicals: ["Imidacloprid", "Mancozeb", "Carbendazim"],
        fertilizers: ["NPK 8:24:24", "Potassium", "Compost"],
        description: "Large fruiting crop requiring ample space and water.",
        careStages: [
            {
                stage: "Planting",
                duration: "1-2 weeks",
                tasks: ["Direct sowing or transplants", "Wide spacing", "Initial care"]
            },
            {
                stage: "Vine Growth",
                duration: "40-50 days",
                tasks: ["Weed control", "Train vines", "Fertilize", "Pest control"]
            },
            {
                stage: "Fruiting",
                duration: "30-40 days",
                tasks: ["Adequate water", "Monitor maturity", "Harvest carefully"]
            }
        ]
    },

    pumpkin: {
        name: "Pumpkin",
        type: "Fruit",
        growthTime: "90-120 days",
        yield: "15-30 tons/ha",
        season: "Aug-Oct (Spring)",
        price: "5-10 Pula/kg",
        water: "Medium",
        soil: "Well-drained, fertile",
        pests: ["Squash Bug", "Aphids", "Cucumber Beetle"],
        diseases: ["Powdery Mildew", "Downy Mildew", "Bacterial Wilt"],
        chemicals: ["Carbaryl", "Sulfur", "Mancozeb"],
        fertilizers: ["NPK 10:20:10", "Compost", "Potassium"],
        description: "Versatile fruit, both immature and mature fruits are edible.",
        careStages: [
            {
                stage: "Planting",
                duration: "1-2 weeks",
                tasks: ["Direct sowing", "Wide spacing", "Initial watering"]
            },
            {
                stage: "Vine Development",
                duration: "50-60 days",
                tasks: ["Weed control", "Train vines", "Fertilize"]
            },
            {
                stage: "Fruit Maturity",
                duration: "30-40 days",
                tasks: ["Harvest young or mature", "Cure mature fruits", "Store properly"]
            }
        ]
    },

    strawberries: {
        name: "Strawberries",
        type: "Fruit",
        growthTime: "60-90 days",
        yield: "10-20 tons/ha",
        season: "Year-round (protected)",
        price: "30-50 Pula/kg",
        water: "High",
        soil: "Well-drained, acidic",
        pests: ["Aphids", "Spider Mites", "Slugs", "Birds"],
        diseases: ["Gray Mold", "Powdery Mildew", "Verticillium Wilt"],
        chemicals: ["Sulfur", "Captan", "Spinosad"],
        fertilizers: ["NPK 10:10:10", "Compost", "Acid fertilizer"],
        description: "High-value fruit, requires careful management and protection.",
        careStages: [
            {
                stage: "Planting",
                duration: "2-3 weeks",
                tasks: ["Plant runners", "Mulch heavily", "Space properly"]
            },
            {
                stage: "Vegetative",
                duration: "30-40 days",
                tasks: ["Regular watering", "Weed control", "Runner management"]
            },
            {
                stage: "Fruiting",
                duration: "20-30 days",
                tasks: ["Harvest daily", "Quality control", "Pest management", "Cool immediately"]
            }
        ]
    }
};

// =============================================
// ENHANCED CROP GUIDE FUNCTIONS - NO EMOJIS
// =============================================

let currentFilters = {
    type: 'all',
    water: 'all',
    season: 'all',
    search: ''
};

// SVG Icon Mapping (No Emojis)
const cropIcons = {
    // Crop Types
    'Cereal': 'icon-cereal',
    'Oilseed': 'icon-oilseed', 
    'Vegetable': 'icon-vegetable',
    'Tuber': 'icon-tuber',
    'Legume': 'icon-legume',
    'Fruit': 'icon-fruit',
    
    // Specific Crops
    'maize': 'icon-maize',
    'sorghum': 'icon-cereal',
    'millet': 'icon-cereal',
    'wheat': 'icon-cereal',
    'barley': 'icon-cereal',
    'oats': 'icon-cereal',
    'safflower': 'icon-oilseed',
    'sunflower': 'icon-oilseed',
    'groundnut': 'icon-oilseed',
    'soybeans': 'icon-oilseed',
    'canola': 'icon-oilseed',
    'tomatoes': 'icon-tomato',
    'cabbage': 'icon-leafy',
    'onions': 'icon-vegetable',
    'carrots': 'icon-carrot',
    'spinach': 'icon-leafy',
    'peppers': 'icon-vegetable',
    'lettuce': 'icon-leafy',
    'green_beans': 'icon-legume',
    'potatoes': 'icon-potato',
    'sweet_potatoes': 'icon-potato',
    'cassava': 'icon-tuber',
    'beetroot': 'icon-vegetable',
    'beans': 'icon-legume',
    'cowpeas': 'icon-legume',
    'peas': 'icon-legume',
    'lentils': 'icon-legume',
    'watermelon': 'icon-fruit',
    'pumpkin': 'icon-fruit',
    'strawberries': 'icon-fruit'
};

// Enhanced loadCropGuide function
function loadCropGuide() {
    const cropSelector = getElement('cropSelector');
    const plantCropSelector = getElement('plantCropType');
    const clientCropSelector = getElement('clientCrop');
    
    // Populate dropdowns (for original simple guide)
    if (cropSelector) {
        cropSelector.innerHTML = '<option value="">-- Choose a crop --</option>';
        for (const [key, crop] of Object.entries(cropDatabase)) {
            const option = document.createElement('option');
            option.value = key;
            option.textContent = crop.name;
            cropSelector.appendChild(option);
        }
    }
    
    if (plantCropSelector) {
        plantCropSelector.innerHTML = '<option value="">Select Crop</option>';
        for (const [key, crop] of Object.entries(cropDatabase)) {
            const option = document.createElement('option');
            option.value = key;
            option.textContent = crop.name;
            plantCropSelector.appendChild(option);
        }
    }
    
    if (clientCropSelector) {
        clientCropSelector.innerHTML = '<option value="">Select Crop</option>';
        for (const [key, crop] of Object.entries(cropDatabase)) {
            const option = document.createElement('option');
            option.value = key;
            option.textContent = crop.name;
            clientCropSelector.appendChild(option);
        }
    }
    
    // Load enhanced crop grid
    loadCropGrid();
    loadSeasonalCalendar();
    updateQuickStats();
}

// Original simple crop details function (for backward compatibility)
function showCropDetails() {
    const cropSelector = getElement('cropSelector');
    const detailsDiv = getElement('cropDetails');
    
    if (!cropSelector || !detailsDiv) return;
    
    const cropKey = cropSelector.value;
    if (!cropKey) {
        detailsDiv.style.display = 'none';
        return;
    }
    
    const crop = cropDatabase[cropKey];
    if (!crop) return;
    
    detailsDiv.innerHTML = `
        <h3>${crop.name} Details</h3>
        <p>${crop.description}</p>
        
        <div class="detail-section">
            <h4>Growth Information</h4>
            <p><strong>Type:</strong> ${crop.type}</p>
            <p><strong>Growth Time:</strong> ${crop.growthTime}</p>
            <p><strong>Yield:</strong> ${crop.yield}</p>
            <p><strong>Planting Season:</strong> ${crop.season}</p>
            <p><strong>Market Price:</strong> ${crop.price}</p>
        </div>
        
        <div class="detail-section">
            <h4>Crop Care Stages</h4>
            ${crop.careStages.map(stage => `
                <div class="care-stage">
                    <h5>${stage.stage} (${stage.duration})</h5>
                    <ul>
                        ${stage.tasks.map(task => `<li>${task}</li>`).join('')}
                    </ul>
                </div>
            `).join('')}
        </div>
        
        <div class="detail-section">
            <h4>Common Pests</h4>
            <ul>
                ${crop.pests.map(pest => `<li>${pest}</li>`).join('')}
            </ul>
        </div>
        
        <div class="detail-section">
            <h4>Common Diseases</h4>
            <ul>
                ${crop.diseases.map(disease => `<li>${disease}</li>`).join('')}
            </ul>
        </div>
        
        <div class="detail-section">
            <h4>Recommended Chemicals</h4>
            <ul>
                ${crop.chemicals.map(chemical => `<li>${chemical}</li>`).join('')}
            </ul>
        </div>
    `;
    
    detailsDiv.style.display = 'block';
}

// Enhanced crop grid functions
function loadCropGrid() {
    const cropGrid = getElement('cropGrid');
    if (!cropGrid) return;
    
    cropGrid.innerHTML = '';
    let visibleCrops = 0;
    
    Object.entries(cropDatabase).forEach(([key, crop]) => {
        if (filterCrop(crop, key)) {
            const cropCard = createCropCard(key, crop);
            cropGrid.appendChild(cropCard);
            visibleCrops++;
        }
    });
    
    // Show/hide no results message
    const noResults = getElement('noResults');
    if (noResults) {
        noResults.style.display = visibleCrops === 0 ? 'block' : 'none';
    }
    
    updateQuickStats();
}

function createCropCard(key, crop) {
    const card = document.createElement('div');
    card.className = 'crop-card';
    card.onclick = () => showEnhancedCropDetails(key);
    
    const iconClass = cropIcons[key] || cropIcons[crop.type] || 'icon-vegetable';
    const waterClass = `water-${crop.water?.toLowerCase() || 'medium'}`;
    
    card.innerHTML = `
        <div class="crop-card-header">
            <div class="crop-icon">
                <span class="icon icon-large ${iconClass}"></span>
            </div>
            <div class="crop-basic-info">
                <h3>${crop.name}</h3>
                <span class="crop-type">${crop.type}</span>
            </div>
        </div>
        
        <div class="crop-quick-stats">
            <div class="stat-item">
                <div class="stat-value">${crop.growthTime}</div>
                <div class="stat-label">Growth Time</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">${crop.yield}</div>
                <div class="stat-label">Yield</div>
            </div>
        </div>
        
        <div class="crop-tags">
            <span class="crop-tag ${waterClass}">
                <span class="icon icon-small icon-water"></span>
                ${crop.water || 'Medium'} Water
            </span>
            <span class="crop-tag">
                <span class="icon icon-small icon-calendar"></span>
                ${crop.season}
            </span>
        </div>
        
        <p style="font-size: 0.9rem; color: #666; margin-bottom: 1rem; line-height: 1.4;">
            ${crop.description}
        </p>
        
        <button class="view-details-btn" onclick="event.stopPropagation(); showEnhancedCropDetails('${key}')">
            <span class="icon icon-small" style="background-image: url('data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 24 24\' fill=\'white\'%3E%3Cpath d=\'M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z\'/%3E%3C/svg%3E');"></span>
            View Details
        </button>
    `;
    
    return card;
}

function filterCrop(crop, key) {
    // Search filter
    if (currentFilters.search) {
        const searchTerm = currentFilters.search.toLowerCase();
        if (!crop.name.toLowerCase().includes(searchTerm) && 
            !crop.type.toLowerCase().includes(searchTerm) &&
            !crop.description.toLowerCase().includes(searchTerm)) {
            return false;
        }
    }
    
    // Type filter
    if (currentFilters.type !== 'all' && crop.type !== currentFilters.type) {
        return false;
    }
    
    // Water filter
    if (currentFilters.water !== 'all' && crop.water !== currentFilters.water) {
        return false;
    }
    
    // Season filter
    if (currentFilters.season !== 'all' && !crop.season.includes(currentFilters.season)) {
        return false;
    }
    
    return true;
}

function filterCrops() {
    const searchInput = getElement('cropSearch');
    if (searchInput) {
        currentFilters.search = searchInput.value.toLowerCase();
    }
    loadCropGrid();
}

function filterByType(type) {
    currentFilters.type = type;
    updateFilterButtons('typeFilters', type);
    loadCropGrid();
}

function filterByWater(water) {
    currentFilters.water = water;
    updateFilterButtons('waterFilters', water);
    loadCropGrid();
}

function filterBySeason(season) {
    currentFilters.season = season;
    updateFilterButtons('seasonFilters', season);
    loadCropGrid();
}

function updateFilterButtons(containerId, activeValue) {
    const container = getElement(containerId);
    if (!container) return;
    
    const buttons = container.getElementsByClassName('filter-option');
    for (let button of buttons) {
        const isActive = button.textContent.includes(activeValue) || 
                        (activeValue === 'all' && button.textContent.includes('All'));
        button.classList.toggle('active', isActive);
    }
}

function clearFilters() {
    currentFilters = {
        type: 'all',
        water: 'all',
        season: 'all',
        search: ''
    };
    
    const searchInput = getElement('cropSearch');
    if (searchInput) searchInput.value = '';
    
    updateFilterButtons('typeFilters', 'all');
    updateFilterButtons('waterFilters', 'all');
    updateFilterButtons('seasonFilters', 'all');
    
    loadCropGrid();
}

function updateQuickStats() {
    const totalCrops = getElement('totalCrops');
    const activeFilters = getElement('activeFilters');
    const currentSeason = getElement('currentSeason');
    
    if (totalCrops) totalCrops.textContent = Object.keys(cropDatabase).length;
    
    if (activeFilters) {
        const activeCount = Object.values(currentFilters).filter(val => val !== 'all').length;
        activeFilters.textContent = activeCount;
    }
    
    if (currentSeason) {
        const month = new Date().getMonth();
        const season = month >= 4 && month <= 6 ? 'Winter' : 
                      month >= 10 || month <= 0 ? 'Summer' : 'Transition';
        currentSeason.textContent = season;
    }
}

function showEnhancedCropDetails(cropKey) {
    const crop = cropDatabase[cropKey];
    if (!crop) return;
    
    const modal = getElement('enhancedCropModal');
    const detailsContainer = getElement('enhancedCropDetails');
    const modalTitle = getElement('modalCropName');
    
    if (!modal || !detailsContainer || !modalTitle) return;
    
    modalTitle.textContent = crop.name;
    
    const iconClass = cropIcons[cropKey] || cropIcons[crop.type] || 'icon-vegetable';
    const waterClass = `water-${crop.water?.toLowerCase() || 'medium'}`;
    
    detailsContainer.innerHTML = `
        <div class="enhanced-crop-details">
            <div class="details-header">
                <div class="details-icon">
                    <span class="icon icon-xlarge ${iconClass}"></span>
                </div>
                <div class="details-title">
                    <h2>${crop.name}</h2>
                    <div class="details-subtitle">${crop.type} ‚Ä¢ ${crop.season}</div>
                    <div class="crop-tags" style="margin-top: 0.5rem;">
                        <span class="crop-tag ${waterClass}">
                            <span class="icon icon-small icon-water"></span>
                            ${crop.water} Water
                        </span>
                        <span class="crop-tag">
                            <span class="icon icon-small icon-calendar"></span>
                            ${crop.growthTime}
                        </span>
                        <span class="crop-tag">
                            <span class="icon icon-small" style="background-image: url('data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 24 24\' fill=\'%23666\'%3E%3Cpath d=\'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z\'/%3E%3C/svg%3E');"></span>
                            ${crop.yield}
                        </span>
                        <span class="crop-tag">
                            <span class="icon icon-small" style="background-image: url('data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 24 24\' fill=\'%23666\'%3E%3Cpath d=\'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z\'/%3E%3C/svg%3E');"></span>
                            ${crop.price}
                        </span>
                    </div>
                </div>
            </div>
            
            <p style="font-size: 1.1rem; line-height: 1.6; margin-bottom: 2rem;">${crop.description}</p>
            
            <div class="details-grid">
                <div class="detail-card">
                    <h4><span class="icon icon-small icon-vegetable"></span> Growing Requirements</h4>
                    <p><strong>Soil:</strong> ${crop.soil}</p>
                    <p><strong>Water Needs:</strong> ${crop.water}</p>
                    <p><strong>Season:</strong> ${crop.season}</p>
                    <p><strong>Growth Time:</strong> ${crop.growthTime}</p>
                </div>
                
                <div class="detail-card">
                    <h4><span class="icon icon-small" style="background-image: url('data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 24 24\' fill=\'%23666\'%3E%3Cpath d=\'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z\'/%3E%3C/svg%3E');"></span> Market Info</h4>
                    <p><strong>Expected Yield:</strong> ${crop.yield}</p>
                    <p><strong>Market Price:</strong> ${crop.price}</p>
                    <p><strong>Fertilizers:</strong> ${crop.fertilizers?.join(', ') || 'NPK based'}</p>
                </div>
                
                <div class="detail-card">
                    <h4><span class="icon icon-small" style="background-image: url('data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 24 24\' fill=\'%23666\'%3E%3Cpath d=\'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z\'/%3E%3C/svg%3E');"></span> Common Pests</h4>
                    <ul class="pest-disease-list">
                        ${crop.pests.map(pest => `<li><span class="icon icon-small" style="background-image: url('data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 24 24\' fill=\'%23666\'%3E%3Ccircle cx=\'12\' cy=\'12\' r=\'2\'/%3E%3C/svg%3E');"></span> ${pest}</li>`).join('')}
                    </ul>
                </div>
                
                <div class="detail-card">
                    <h4><span class="icon icon-small" style="background-image: url('data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 24 24\' fill=\'%23666\'%3E%3Cpath d=\'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z\'/%3E%3C/svg%3E');"></span> Common Diseases</h4>
                    <ul class="pest-disease-list">
                        ${crop.diseases.map(disease => `<li><span class="icon icon-small" style="background-image: url('data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 24 24\' fill=\'%23666\'%3E%3Ccircle cx=\'12\' cy=\'12\' r=\'2\'/%3E%3C/svg%3E');"></span> ${disease}</li>`).join('')}
                    </ul>
                </div>
                
                <div class="detail-card">
                    <h4><span class="icon icon-small" style="background-image: url('data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 24 24\' fill=\'%23666\'%3E%3Cpath d=\'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z\'/%3E%3C/svg%3E');"></span> Recommended Chemicals</h4>
                    <ul class="pest-disease-list">
                        ${crop.chemicals.map(chem => `<li><span class="icon icon-small" style="background-image: url('data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 24 24\' fill=\'%23666\'%3E%3Ccircle cx=\'12\' cy=\'12\' r=\'2\'/%3E%3C/svg%3E');"></span> ${chem}</li>`).join('')}
                    </ul>
                </div>
            </div>
            
            <div class="care-timeline">
                <h4><span class="icon icon-small icon-calendar"></span> Crop Care Timeline</h4>
                ${crop.careStages.map(stage => `
                    <div class="timeline-item">
                        <div class="timeline-duration">${stage.duration}</div>
                        <div class="timeline-content">
                            <h5>${stage.stage}</h5>
                            <ul class="timeline-tasks">
                                ${stage.tasks.map(task => `<li><span class="icon icon-small" style="background-image: url('data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 24 24\' fill=\'%23388e3c\'%3E%3Cpath d=\'M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z\'/%3E%3C/svg%3E');"></span> ${task}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                `).join('')}
            </div>
        </div>
    `;
    
    modal.style.display = 'flex';
}

function closeEnhancedCropModal() {
    const modal = getElement('enhancedCropModal');
    if (modal) modal.style.display = 'none';
}

function loadSeasonalCalendar() {
    const calendar = getElement('seasonCalendar');
    if (!calendar) return;
    
    const months = [
        'January', 'February', 'March', 'April', 'May', 'June',
        'July', 'August', 'September', 'October', 'November', 'December'
    ];
    
    const currentMonth = new Date().getMonth();
    
    calendar.innerHTML = months.map((month, index) => {
        const isActive = index === currentMonth;
        const season = getSeason(index);
        return `
            <div class="season-month ${isActive ? 'active' : ''}">
                <div class="month-name">${month}</div>
                <div class="season-indicator">${season}</div>
            </div>
        `;
    }).join('');
    
    loadCurrentSeasonCrops();
}

function getSeason(month) {
    if (month >= 4 && month <= 6) return 'Winter';
    if (month >= 10 || month <= 0) return 'Summer';
    return 'Transition';
}

function loadCurrentSeasonCrops() {
    const container = getElement('currentSeasonCrops');
    if (!container) return;
    
    const currentMonth = new Date().getMonth();
    const currentSeason = getSeason(currentMonth);
    
    const seasonCrops = Object.entries(cropDatabase).filter(([key, crop]) => {
        return crop.season.includes(currentSeason) || crop.season.includes('Year-round');
    }).slice(0, 6); // Show top 6 crops
    
    container.innerHTML = seasonCrops.map(([key, crop]) => {
        const iconClass = cropIcons[key] || cropIcons[crop.type] || 'icon-vegetable';
        return `
            <div class="crop-mini-card" onclick="showEnhancedCropDetails('${key}')">
                <div class="mini-icon">
                    <span class="icon icon-medium ${iconClass}"></span>
                </div>
                <div class="mini-info">
                    <strong>${crop.name}</strong>
                    <div>${crop.growthTime}</div>
                </div>
            </div>
        `;
    }).join('');
}


// =============================================
// MY CROPS FUNCTIONS
// =============================================

function loadMyCrops() {
    const plantedCropsList = getElement('plantedCropsList');
    if (!plantedCropsList) return;
    
    plantedCropsList.innerHTML = '';
    
    if (farmData.plantedCrops.length === 0) {
        plantedCropsList.innerHTML = '<div style="text-align: center; padding: 2rem; color: var(--muted);">No crops planted yet</div>';
        return;
    }
    
    farmData.plantedCrops.forEach((crop, index) => {
        const cropInfo = cropDatabase[crop.type];
        if (!cropInfo) return;
        
        const plantedDate = new Date(crop.plantedDate);
        const growthDays = parseInt(cropInfo.growthTime.split('-')[0]);
        const harvestDate = new Date(plantedDate.getTime() + (growthDays * 24 * 60 * 60 * 1000));
        const today = new Date();
        
        // Calculate progress
        const totalGrowthTime = harvestDate - plantedDate;
        const elapsedTime = today - plantedDate;
        const progress = Math.min(Math.max((elapsedTime / totalGrowthTime) * 100, 0), 100);
        
        // Calculate expected yield
        const yieldRange = cropInfo.yield.split('-');
        const minYield = parseFloat(yieldRange[0]);
        const maxYield = parseFloat(yieldRange[1]);
        const expectedYield = ((minYield + maxYield) / 2) * crop.area;
        
        const cropCard = document.createElement('div');
        cropCard.className = 'planted-crop-card';
        cropCard.innerHTML = `
            <h3>${cropInfo.name}</h3>
            <div class="muted">Planted on ${plantedDate.toLocaleDateString()}</div>
            <div><strong>Area:</strong> ${crop.area} hectares</div>
            <div><strong>Expected Harvest:</strong> ${harvestDate.toLocaleDateString()}</div>
            <div><strong>Expected Yield:</strong> ${expectedYield.toFixed(1)} tons</div>
            
            <div class="crop-status">
                <div>Growth Progress</div>
                <div>${Math.round(progress)}%</div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill-bar" style="width: ${progress}%">${Math.round(progress)}%</div>
            </div>
            
            <button onclick="harvestCrop(${index})" class="small" style="margin-top: 0.5rem;">Harvest</button>
        `;
        
        plantedCropsList.appendChild(cropCard);
    });
}

function plantCrop() {
    const cropTypeInput = getElement('plantCropType');
    const areaInput = getElement('plantArea');
    const dateInput = getElement('plantDate');
    
    if (!cropTypeInput || !areaInput || !dateInput) return;
    
    const cropType = cropTypeInput.value;
    const area = parseFloat(areaInput.value);
    const plantedDate = dateInput.value;
    
    if (!cropType || !area || !plantedDate) {
        alert('Please fill all fields');
        return;
    }
    
    if (area <= 0) {
        alert('Please enter a valid area');
        return;
    }
    
    const newCrop = {
        type: cropType,
        area: area,
        plantedDate: plantedDate
    };
    
    farmData.plantedCrops.push(newCrop);
    saveData();
    loadMyCrops();
    updateDashboard();
    
    // Clear form
    cropTypeInput.value = '';
    areaInput.value = '';
    dateInput.value = '';
    
    alert('Crop planted successfully!');
}

function harvestCrop(index) {
    if (confirm('Are you sure you want to mark this crop as harvested?')) {
        farmData.plantedCrops.splice(index, 1);
        saveData();
        loadMyCrops();
        updateDashboard();
        alert('Crop harvested successfully!');
    }
}

// =============================================
// TASKS FUNCTIONS
// =============================================

function loadTasks() {
    const tasksList = getElement('tasksList');
    if (!tasksList) return;
    
    tasksList.innerHTML = '';
    
    if (farmData.tasks.length === 0) {
        tasksList.innerHTML = '<div style="text-align: center; padding: 2rem; color: var(--muted);">No tasks created yet</div>';
        return;
    }
    
    farmData.tasks.forEach((task, index) => {
        const startDate = new Date(task.startDate);
        const dueDate = new Date(task.dueDate);
        const today = new Date();
        
        // Calculate progress
        const totalTime = dueDate - startDate;
        const elapsedTime = today - startDate;
        let progress = Math.min(Math.max((elapsedTime / totalTime) * 100, 0), 100);
        
        if (today > dueDate) progress = 100;
        
        const taskCard = document.createElement('div');
        taskCard.className = 'task-card';
        taskCard.innerHTML = `
            <div class="task-header">
                <h3>${task.description}</h3>
                <span style="color: ${task.priority === 'high' ? 'var(--danger)' : task.priority === 'medium' ? 'var(--warning)' : 'var(--primary)'}">${task.priority.toUpperCase()}</span>
            </div>
            <div class="muted">Start: ${startDate.toLocaleDateString()} | Due: ${dueDate.toLocaleDateString()}</div>
            
            <div class="crop-status">
                <div>Progress</div>
                <div>${Math.round(progress)}%</div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill-bar" style="width: ${progress}%">${Math.round(progress)}%</div>
            </div>
            
            <button onclick="completeTask(${index})" class="small" style="margin-top: 0.5rem;">Complete</button>
        `;
        
        tasksList.appendChild(taskCard);
    });
}

function createTask() {
    const descriptionInput = getElement('taskDescription');
    const startDateInput = getElement('taskStartDate');
    const dueDateInput = getElement('taskDueDate');
    const priorityInput = getElement('taskPriority');
    
    if (!descriptionInput || !startDateInput || !dueDateInput || !priorityInput) return;
    
    const description = descriptionInput.value.trim();
    const startDate = startDateInput.value;
    const dueDate = dueDateInput.value;
    const priority = priorityInput.value;
    
    if (!description || !startDate || !dueDate) {
        alert('Please fill all fields');
        return;
    }
    
    if (new Date(dueDate) < new Date(startDate)) {
        alert('Due date must be after start date');
        return;
    }
    
    const newTask = {
        description: description,
        startDate: startDate,
        dueDate: dueDate,
        priority: priority,
        completed: false
    };
    
    farmData.tasks.push(newTask);
    saveData();
    loadTasks();
    updateDashboard();
    
    // Clear form
    descriptionInput.value = '';
    startDateInput.value = '';
    dueDateInput.value = '';
    priorityInput.value = 'medium';
    
    alert('Task created successfully!');
}

function completeTask(index) {
    if (confirm('Mark this task as completed?')) {
        farmData.tasks.splice(index, 1);
        saveData();
        loadTasks();
        updateDashboard();
        alert('Task completed!');
    }
}

// =============================================
// CLIENT FUNCTIONS
// =============================================

function loadClients() {
    const clientsList = getElement('clientsList');
    if (!clientsList) return;
    
    clientsList.innerHTML = '';
    
    // Ensure clients array exists
    if (!farmData.clients) {
        farmData.clients = [];
    }
    
    if (farmData.clients.length === 0) {
        clientsList.innerHTML = '<div style="text-align: center; padding: 2rem; color: var(--muted);">No clients added yet</div>';
        return;
    }
    
    farmData.clients.forEach((client, index) => {
        const cropInfo = cropDatabase[client.desiredCrop];
        
        const clientCard = document.createElement('div');
        clientCard.className = 'client-card';
        clientCard.innerHTML = `
            <h3>${client.name}</h3>
            <div class="muted">${client.contact} | ${client.email || 'No email'}</div>
            <div><strong>Desired Crop:</strong> ${cropInfo ? cropInfo.name : client.desiredCrop}</div>
            <div><strong>Notes:</strong> ${client.notes || 'No notes'}</div>
            
            <div class="client-actions">
                <button onclick="contactClient(${index})" class="small">Contact</button>
                <button onclick="editClient(${index})" class="small btn-outline">Edit</button>
                <button onclick="removeClient(${index})" class="small btn-outline">Remove</button>
            </div>
        `;
        
        clientsList.appendChild(clientCard);
    });
}

function addClient() {
    try {
        const nameInput = getElement('clientName');
        const contactInput = getElement('clientContact');
        const emailInput = getElement('clientEmail');
        const cropInput = getElement('clientCrop');
        const notesInput = getElement('clientNotes');
        
        if (!nameInput || !contactInput || !cropInput) {
            alert('Please fill all required fields');
            return;
        }
        
        const name = nameInput.value.trim();
        const contact = contactInput.value.trim();
        const email = emailInput ? emailInput.value.trim() : '';
        const desiredCrop = cropInput.value;
        const notes = notesInput ? notesInput.value.trim() : '';
        
        if (!name || !contact || !desiredCrop) {
            alert('Please fill required fields (Name, Contact, and Desired Crop)');
            return;
        }
        
        // Ensure clients array exists
        if (!farmData.clients) {
            farmData.clients = [];
        }
        
        const newClient = {
            name: name,
            contact: contact,
            email: email,
            desiredCrop: desiredCrop,
            notes: notes,
            addedDate: new Date().toISOString()
        };
        
        farmData.clients.push(newClient);
        
        if (saveData()) {
            loadClients();
            updateDashboard();
            // Clear form
            nameInput.value = '';
            contactInput.value = '';
            if (emailInput) emailInput.value = '';
            cropInput.value = '';
            if (notesInput) notesInput.value = '';
            alert('Client added successfully!');
        } else {
            // Remove client if save failed
            farmData.clients.pop();
            alert('Failed to save client. Please try again.');
        }
        
    } catch (error) {
        console.error('Error adding client:', error);
        alert('Error adding client. Please try again.');
    }
}

function contactClient(index) {
    const client = farmData.clients[index];
    alert(`Contacting ${client.name}\nPhone: ${client.contact}\nEmail: ${client.email || 'Not provided'}`);
}

function editClient(index) {
    const client = farmData.clients[index];
    
    // Populate form with client data
    const nameInput = getElement('clientName');
    const contactInput = getElement('clientContact');
    const emailInput = getElement('clientEmail');
    const cropInput = getElement('clientCrop');
    const notesInput = getElement('clientNotes');
    
    if (nameInput) nameInput.value = client.name;
    if (contactInput) contactInput.value = client.contact;
    if (emailInput) emailInput.value = client.email || '';
    if (cropInput) cropInput.value = client.desiredCrop;
    if (notesInput) notesInput.value = client.notes || '';
    
    // Remove the client to be edited
    farmData.clients.splice(index, 1);
    saveData();
    loadClients();
    updateDashboard();
    
    alert('Client data loaded for editing. Update the form and click "Add Client" to save changes.');
}

function removeClient(index) {
    const client = farmData.clients[index];
    if (!client) return;
    
    if (confirm(`Are you sure you want to remove ${client.name}?`)) {
        farmData.clients.splice(index, 1);
        if (saveData()) {
            loadClients();
            updateDashboard();
            alert('Client removed successfully!');
        } else {
            alert('Failed to remove client. Please try again.');
        }
    }
}

// =============================================
// REPORTS FUNCTIONS
// =============================================

function showReport(type) {
    const reportContent = getElement('reportContent');
    if (!reportContent) return;
    
    reportContent.style.display = 'block';
    
    let reportHTML = `<h3>${type.charAt(0).toUpperCase() + type.slice(1)} Report</h3>`;
    
    switch(type) {
        case 'crop':
            reportHTML += generateCropReport();
            break;
        case 'finance':
            reportHTML += generateFinanceReport();
            break;
        case 'tasks':
            reportHTML += generateTasksReport();
            break;
        case 'inventory':
            reportHTML += generateInventoryReport();
            break;
        case 'clients':
            reportHTML += generateClientReport();
            break;
    }
    
    reportContent.innerHTML = reportHTML;
}

function generateCropReport() {
    let html = `<p>Generated on: ${new Date().toLocaleDateString()}</p>`;
    
    if (farmData.plantedCrops.length === 0) {
        html += '<p>No crops planted</p>';
        return html;
    }
    
    html += '<table><tr><th>Crop</th><th>Area (ha)</th><th>Planted Date</th><th>Expected Yield</th><th>Progress</th></tr>';
    
    farmData.plantedCrops.forEach(crop => {
        const cropInfo = cropDatabase[crop.type];
        if (!cropInfo) return;
        
        const plantedDate = new Date(crop.plantedDate);
        const growthDays = parseInt(cropInfo.growthTime.split('-')[0]);
        const harvestDate = new Date(plantedDate.getTime() + (growthDays * 24 * 60 * 60 * 1000));
        const today = new Date();
        
        // Calculate progress
        const totalGrowthTime = harvestDate - plantedDate;
        const elapsedTime = today - plantedDate;
        const progress = Math.min(Math.max((elapsedTime / totalGrowthTime) * 100, 0), 100);
        
        // Calculate expected yield
        const yieldRange = cropInfo.yield.split('-');
        const minYield = parseFloat(yieldRange[0]);
        const maxYield = parseFloat(yieldRange[1]);
        const expectedYield = ((minYield + maxYield) / 2) * crop.area;
        
        html += `<tr>
            <td>${cropInfo.name}</td>
            <td>${crop.area}</td>
            <td>${plantedDate.toLocaleDateString()}</td>
            <td>${expectedYield.toFixed(1)} tons</td>
            <td>${Math.round(progress)}%</td>
        </tr>`;
    });
    
    html += '</table>';
    return html;
}

function generateFinanceReport() {
    let html = `<p>Generated on: ${new Date().toLocaleDateString()}</p>`;
    
    // Calculate totals
    const totalIncome = farmData.finances.income.reduce((sum, item) => sum + item.amount, 0);
    const totalExpenses = farmData.finances.expenses.reduce((sum, item) => sum + item.amount, 0);
    const netBalance = totalIncome - totalExpenses;
    
    html += `<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
        <div style="background: white; padding: 1rem; border-radius: 8px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-top: 4px solid var(--primary);">
            <div style="color: var(--muted); font-size: 0.9rem;">Total Income</div>
            <div style="font-size: 2.2rem; font-weight: bold; color: var(--primary);">${totalIncome.toFixed(2)} Pula</div>
        </div>
        
        <div style="background: white; padding: 1rem; border-radius: 8px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-top: 4px solid var(--danger);">
            <div style="color: var(--muted); font-size: 0.9rem;">Total Expenses</div>
            <div style="font-size: 2.2rem; font-weight: bold; color: var(--danger);">${totalExpenses.toFixed(2)} Pula</div>
        </div>
        
        <div style="background: white; padding: 1rem; border-radius: 8px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-top: 4px solid var(--info);">
            <div style="color: var(--muted); font-size: 0.9rem;">Net Balance</div>
            <div style="font-size: 2.2rem; font-weight: bold; color: var(--info);">${netBalance.toFixed(2)} Pula</div>
        </div>
    </div>`;
    
    return html;
}

function generateTasksReport() {
    let html = `<p>Generated on: ${new Date().toLocaleDateString()}</p>`;
    
    if (farmData.tasks.length === 0) {
        html += '<p>No tasks created</p>';
        return html;
    }
    
    const completedTasks = farmData.tasks.filter(task => task.completed).length;
    const completionRate = farmData.tasks.length > 0 ? (completedTasks / farmData.tasks.length) * 100 : 0;
    
    html += `<p>Total Tasks: ${farmData.tasks.length}</p>`;
    html += `<p>Completion Rate: ${completionRate.toFixed(1)}%</p>`;
    
    html += '<table><tr><th>Task</th><th>Start Date</th><th>Due Date</th><th>Priority</th><th>Status</th></tr>';
    
    farmData.tasks.forEach(task => {
        const status = task.completed ? 'Completed' : 'In Progress';
        html += `<tr>
            <td>${task.description}</td>
            <td>${new Date(task.startDate).toLocaleDateString()}</td>
            <td>${new Date(task.dueDate).toLocaleDateString()}</td>
            <td>${task.priority}</td>
            <td>${status}</td>
        </tr>`;
    });
    
    html += '</table>';
    return html;
}

function generateInventoryReport() {
    let html = `<p>Generated on: ${new Date().toLocaleDateString()}</p>`;
    
    if (farmData.inventory.length === 0) {
        html += '<p>No inventory items</p>';
        return html;
    }
    
    const totalValue = farmData.inventory.reduce((sum, item) => sum + (item.quantity * item.price), 0);
    
    html += `<p>Total Inventory Value: ${totalValue.toFixed(2)} Pula</p>`;
    
    html += '<table><tr><th>Product</th><th>Category</th><th>Quantity</th><th>Price</th><th>Value</th></tr>';
    
    farmData.inventory.forEach(item => {
        const value = item.quantity * item.price;
        html += `<tr>
            <td>${item.name}</td>
            <td>${item.category}</td>
            <td>${item.quantity}</td>
            <td>${item.price.toFixed(2)} Pula</td>
            <td>${value.toFixed(2)} Pula</td>
        </tr>`;
    });
    
    html += '</table>';
    return html;
}

function generateClientReport() {
    let html = `<p>Generated on: ${new Date().toLocaleDateString()}</p>`;
    
    if (farmData.clients.length === 0) {
        html += '<p>No clients added</p>';
        return html;
    }
    
    const stats = {
        total: farmData.clients.length,
        byCrop: {},
        withEmail: 0,
        withNotes: 0
    };
    
    // Count clients by desired crop
    farmData.clients.forEach(client => {
        const crop = client.desiredCrop;
        stats.byCrop[crop] = (stats.byCrop[crop] || 0) + 1;
        
        if (client.email && client.email.trim()) {
            stats.withEmail++;
        }
        
        if (client.notes && client.notes.trim()) {
            stats.withNotes++;
        }
    });
    
    html += `<p><strong>Total Clients:</strong> ${stats.total}</p>`;
    html += `<p><strong>Clients with Email:</strong> ${stats.withEmail} (${((stats.withEmail / stats.total) * 100).toFixed(1)}%)</p>`;
    html += `<p><strong>Clients with Notes:</strong> ${stats.withNotes} (${((stats.withNotes / stats.total) * 100).toFixed(1)}%)</p>`;
    
    if (Object.keys(stats.byCrop).length > 0) {
        html += '<h4>Clients by Desired Crop</h4><table><tr><th>Crop</th><th>Client Count</th></tr>';
        
        Object.entries(stats.byCrop).forEach(([crop, count]) => {
            const cropInfo = cropDatabase[crop];
            html += `<tr><td>${cropInfo ? cropInfo.name : crop}</td><td>${count}</td></tr>`;
        });
        
        html += '</table>';
    }
    
    return html;
}

function printReport() {
    const reportContent = getElement('reportContent');
    if (!reportContent) return;
    
    const reportHTML = reportContent.innerHTML;
    const printWindow = window.open('', '_blank');
    printWindow.document.write(`
        <html>
            <head>
                <title>FarmPro Report</title>
                <style>
                    body { font-family: Arial, sans-serif; margin: 20px; }
                    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
                    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                    th { background-color: #388e3c; color: white; }
                </style>
            </head>
            <body>
                <h1>FarmPro Assistant Report</h1>
                ${reportHTML}
            </body>
        </html>
    `);
    printWindow.document.close();
    printWindow.print();
}

function exportReport() {
    const dataStr = JSON.stringify(farmData, null, 2);
    const dataBlob = new Blob([dataStr], {type: 'application/json'});
    
    const link = document.createElement('a');
    link.href = URL.createObjectURL(dataBlob);
    link.download = `farmpro-data-${new Date().toISOString().split('T')[0]}.json`;
    link.click();
}
// =============================================
// ENHANCED REPORTING SYSTEM
// =============================================

let currentReportPeriod = 'weekly';
let reportCharts = {};

function showReport(type) {
    // Legacy function for backward compatibility
    setReportPeriod(type);
}

function setReportPeriod(period) {
    currentReportPeriod = period;
    
    // Update active button
    document.querySelectorAll('.period-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    event.target.classList.add('active');
    
    // Show/hide custom date range
    const customRange = getElement('customDateRange');
    if (customRange) {
        customRange.style.display = period === 'custom' ? 'block' : 'none';
    }
    
    // Generate report
    generateReport();
}

function generateReport() {
    const dateRange = getDateRange(currentReportPeriod);
    generateQuickStats(dateRange);
    generateReportCards(dateRange);
    generateCharts(dateRange);
    generateTables(dateRange);
}

function generateCustomReport() {
    const startDate = getElement('startDate').value;
    const endDate = getElement('endDate').value;
    
    if (!startDate || !endDate) {
        alert('Please select both start and end dates');
        return;
    }
    
    const dateRange = {
        start: new Date(startDate),
        end: new Date(endDate),
        period: 'custom'
    };
    
    generateQuickStats(dateRange);
    generateReportCards(dateRange);
    generateCharts(dateRange);
    generateTables(dateRange);
}

function getDateRange(period) {
    const now = new Date();
    let start, end;
    
    switch(period) {
        case 'weekly':
            start = new Date(now);
            start.setDate(now.getDate() - 7);
            end = new Date(now);
            break;
            
        case 'monthly':
            start = new Date(now.getFullYear(), now.getMonth(), 1);
            end = new Date(now.getFullYear(), now.getMonth() + 1, 0);
            break;
            
        case 'yearly':
            start = new Date(now.getFullYear(), 0, 1);
            end = new Date(now.getFullYear(), 11, 31);
            break;
            
        default:
            start = new Date(now);
            start.setDate(now.getDate() - 7);
            end = new Date(now);
    }
    
    return { start, end, period };
}

function generateQuickStats(dateRange) {
    const container = getElement('reportQuickStats');
    if (!container) return;
    
    const stats = calculateQuickStats(dateRange);
    
    container.innerHTML = `
        <div class="quick-stat">
            <div class="quick-stat-value">${stats.totalSales}</div>
            <div class="quick-stat-label">Total Sales</div>
        </div>
        <div class="quick-stat">
            <div class="quick-stat-value">${stats.totalIncome}</div>
            <div class="quick-stat-label">Total Income</div>
        </div>
        <div class="quick-stat">
            <div class="quick-stat-value">${stats.totalExpenses}</div>
            <div class="quick-stat-label">Total Expenses</div>
        </div>
        <div class="quick-stat">
            <div class="quick-stat-value">${stats.netProfit}</div>
            <div class="quick-stat-label">Net Profit</div>
        </div>
        <div class="quick-stat">
            <div class="quick-stat-value">${stats.activeCrops}</div>
            <div class="quick-stat-label">Active Crops</div>
        </div>
        <div class="quick-stat">
            <div class="quick-stat-value">${stats.completedTasks}</div>
            <div class="quick-stat-label">Completed Tasks</div>
        </div>
    `;
}

function calculateQuickStats(dateRange) {
    const periodSales = farmData.sales.filter(sale => 
        new Date(sale.timestamp) >= dateRange.start && 
        new Date(sale.timestamp) <= dateRange.end
    );
    
    const periodIncome = farmData.finances.income.filter(income =>
        new Date(income.timestamp) >= dateRange.start && 
        new Date(income.timestamp) <= dateRange.end
    );
    
    const periodExpenses = farmData.finances.expenses.filter(expense =>
        new Date(expense.timestamp) >= dateRange.start && 
        new Date(expense.timestamp) <= dateRange.end
    );
    
    const totalSales = periodSales.reduce((sum, sale) => sum + sale.total, 0);
    const totalIncome = periodIncome.reduce((sum, income) => sum + income.amount, 0);
    const totalExpenses = periodExpenses.reduce((sum, expense) => sum + expense.amount, 0);
    const netProfit = totalIncome - totalExpenses;
    
    const activeCrops = farmData.plantedCrops.length;
    const completedTasks = farmData.tasks.filter(task => task.completed).length;
    
    return {
        totalSales: `P ${totalSales.toFixed(2)}`,
        totalIncome: `P ${totalIncome.toFixed(2)}`,
        totalExpenses: `P ${totalExpenses.toFixed(2)}`,
        netProfit: `P ${netProfit.toFixed(2)}`,
        activeCrops: activeCrops,
        completedTasks: `${completedTasks}/${farmData.tasks.length}`
    };
}

function generateReportCards(dateRange) {
    const container = getElement('reportCards');
    if (!container) return;
    
    const stats = calculateReportCardStats(dateRange);
    
    container.innerHTML = `
        <div class="report-card income">
            <h4>Total Income</h4>
            <div class="report-value positive">${stats.income.current}</div>
            <div class="report-change ${stats.income.change >= 0 ? 'positive' : 'negative'}">
                ${stats.income.change >= 0 ? '‚Üó' : '‚Üò'} ${Math.abs(stats.income.change)}%
            </div>
        </div>
        
        <div class="report-card expenses">
            <h4>Total Expenses</h4>
            <div class="report-value ${stats.expenses.change >= 0 ? 'negative' : 'positive'}">${stats.expenses.current}</div>
            <div class="report-change ${stats.expenses.change >= 0 ? 'negative' : 'positive'}">
                ${stats.expenses.change >= 0 ? '‚Üó' : '‚Üò'} ${Math.abs(stats.expenses.change)}%
            </div>
        </div>
        
        <div class="report-card sales">
            <h4>Sales Volume</h4>
            <div class="report-value neutral">${stats.sales.transactions}</div>
            <div class="report-change ${stats.sales.change >= 0 ? 'positive' : 'negative'}">
                ${stats.sales.change >= 0 ? '‚Üó' : '‚Üò'} ${Math.abs(stats.sales.change)}%
            </div>
        </div>
        
        <div class="report-card inventory">
            <h4>Inventory Value</h4>
            <div class="report-value neutral">${stats.inventory.value}</div>
            <div>${stats.inventory.items} items</div>
        </div>
    `;
}

function calculateReportCardStats(dateRange) {
    // This would compare with previous period
    // For now, returning mock data structure
    return {
        income: { current: 'P 15,250.00', change: 12.5 },
        expenses: { current: 'P 8,430.00', change: -3.2 },
        sales: { transactions: '247', change: 8.7 },
        inventory: { value: 'P 45,680.00', items: '156' }
    };
}

function generateCharts(dateRange) {
    // Initialize or update charts
    createIncomeExpenseChart(dateRange);
    createSalesCategoryChart(dateRange);
    createCropPerformanceChart(dateRange);
    createInventoryTrendChart(dateRange);
}

function generateTables(dateRange) {
    generateTransactionTable(dateRange);
    generateTopProductsTable(dateRange);
    generateCropProgressTable(dateRange);
}

// Chart creation functions (simplified - you'd integrate with Chart.js)
function createIncomeExpenseChart(dateRange) {
    const ctx = document.getElementById('incomeExpenseChart')?.getContext('2d');
    if (!ctx) return;
    
    // This is where you'd integrate with Chart.js
    // For now, just showing the canvas
    console.log('Creating income/expense chart for:', dateRange);
}

function createSalesCategoryChart(dateRange) {
    const ctx = document.getElementById('salesCategoryChart')?.getContext('2d');
    if (!ctx) return;
    
    console.log('Creating sales category chart for:', dateRange);
}

function createCropPerformanceChart(dateRange) {
    const ctx = document.getElementById('cropPerformanceChart')?.getContext('2d');
    if (!ctx) return;
    
    console.log('Creating crop performance chart for:', dateRange);
}

function createInventoryTrendChart(dateRange) {
    const ctx = document.getElementById('inventoryTrendChart')?.getContext('2d');
    if (!ctx) return;
    
    console.log('Creating inventory trend chart for:', dateRange);
}

// Table generation functions
function generateTransactionTable(dateRange) {
    const container = getElement('transactionTable');
    if (!container) return;
    
    const recentTransactions = [
        ...farmData.finances.income.map(t => ({...t, type: 'income'})),
        ...farmData.finances.expenses.map(t => ({...t, type: 'expense'}))
    ]
    .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
    .slice(0, 10);
    
    container.innerHTML = `
        <table class="report-table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Description</th>
                    <th>Category</th>
                    <th>Amount</th>
                </tr>
            </thead>
            <tbody>
                ${recentTransactions.map(transaction => `
                    <tr>
                        <td>${new Date(transaction.timestamp).toLocaleDateString()}</td>
                        <td>${transaction.description}</td>
                        <td>${transaction.category}</td>
                        <td style="color: ${transaction.type === 'income' ? '#4caf50' : '#f44336'}; font-weight: bold;">
                            ${transaction.type === 'income' ? '+' : '-'}P ${transaction.amount.toFixed(2)}
                        </td>
                    </tr>
                `).join('')}
            </tbody>
        </table>
    `;
}

function generateTopProductsTable(dateRange) {
    const container = getElement('topProductsTable');
    if (!container) return;
    
    // Calculate top selling products
    const productSales = {};
    farmData.sales.forEach(sale => {
        sale.items.forEach(item => {
            productSales[item.name] = (productSales[item.name] || 0) + item.quantity;
        });
    });
    
    const topProducts = Object.entries(productSales)
        .sort(([,a], [,b]) => b - a)
        .slice(0, 10);
    
    container.innerHTML = `
        <table class="report-table">
            <thead>
                <tr>
                    <th>Product</th>
                    <th>Units Sold</th>
                    <th>Revenue</th>
                </tr>
            </thead>
            <tbody>
                ${topProducts.map(([product, units]) => `
                    <tr>
                        <td>${product}</td>
                        <td>${units}</td>
                        <td>P ${(units * 50).toFixed(2)}</td> <!-- Mock revenue -->
                    </tr>
                `).join('')}
            </tbody>
        </table>
    `;
}

function generateCropProgressTable(dateRange) {
    const container = getElement('cropProgressTable');
    if (!container) return;
    
    container.innerHTML = `
        <table class="report-table">
            <thead>
                <tr>
                    <th>Crop</th>
                    <th>Area (ha)</th>
                    <th>Planted</th>
                    <th>Progress</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                ${farmData.plantedCrops.map(crop => {
                    const cropInfo = cropDatabase[crop.type];
                    const progress = calculateCropProgress(crop);
                    return `
                        <tr>
                            <td>${cropInfo?.name || crop.type}</td>
                            <td>${crop.area}</td>
                            <td>${new Date(crop.plantedDate).toLocaleDateString()}</td>
                            <td>
                                <div style="background: #f0f0f0; border-radius: 10px; height: 8px;">
                                    <div style="background: #388e3c; width: ${progress}%; height: 100%; border-radius: 10px;"></div>
                                </div>
                                <small>${progress}%</small>
                            </td>
                            <td>
                                <span style="color: ${progress < 100 ? '#ff9800' : '#4caf50'};">
                                    ${progress < 100 ? 'Growing' : 'Ready for Harvest'}
                                </span>
                            </td>
                        </tr>
                    `;
                }).join('')}
            </tbody>
        </table>
    `;
}

function calculateCropProgress(crop) {
    const cropInfo = cropDatabase[crop.type];
    if (!cropInfo) return 0;
    
    const plantedDate = new Date(crop.plantedDate);
    const growthDays = parseInt(cropInfo.growthTime.split('-')[0]);
    const harvestDate = new Date(plantedDate.getTime() + (growthDays * 24 * 60 * 60 * 1000));
    const today = new Date();
    
    const totalGrowthTime = harvestDate - plantedDate;
    const elapsedTime = today - plantedDate;
    return Math.min(Math.max((elapsedTime / totalGrowthTime) * 100, 0), 100);
}

// Export functions
function exportReport(format) {
    switch(format) {
        case 'pdf':
            alert('PDF export would be generated here');
            // Integrate with pdf-lib or similar library
            break;
        case 'excel':
            exportToExcel();
            break;
    }
}

function exportToExcel() {
    const data = JSON.stringify(farmData, null, 2);
    const blob = new Blob([data], { type: 'application/vnd.ms-excel' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = `farm-report-${new Date().toISOString().split('T')[0]}.xlsx`;
    link.click();
}

function printReport() {
    window.print();
}

function scheduleReport() {
    const modal = getElement('scheduleModal');
    if (modal) modal.style.display = 'flex';
}

function closeScheduleModal() {
    const modal = getElement('scheduleModal');
    if (modal) modal.style.display = 'none';
}

function saveSchedule() {
    const weekly = getElement('weeklyEmail').checked;
    const monthly = getElement('monthlyEmail').checked;
    const yearly = getElement('yearlyEmail').checked;
    
    // Save schedule preferences
    localStorage.setItem('reportSchedule', JSON.stringify({
        weekly, monthly, yearly
    }));
    
    alert('Report schedule saved successfully!');
    closeScheduleModal();
}

// Initialize reporting when section is shown
function initializeReports() {
    setReportPeriod('weekly');
}

// Add to global functions
// =============================================
// APP INITIALIZATION
// =============================================

function initializeAppFeatures() {
    loadCropGuide();
    loadMyCrops();
    loadTasks();
    loadClients();
    loadPOSProducts();
    loadInventory();
    loadFinanceData();
    updateDashboard();
}

function initializeApp() {
    console.log('Initializing app with data:', farmData);
    
    // Check if trial should be active
    if (gpsData.trialStart) {
        const trialStart = new Date(gpsData.trialStart);
        const now = new Date();
        const daysElapsed = (now - trialStart) / (1000 * 60 * 60 * 24);
        
        if (daysElapsed < 7) {
            // Trial still active
            startTrial();
            updateGPSStatus();
            
            if (gpsData.confirmed) {
                const activateBtn = getElement('activateBtn');
                if (activateBtn) activateBtn.style.display = 'block';
            }
            
            if (appActivated) {
                enableFullAccess();
            }
        } else {
            // Trial expired
            trialExpired = true;
            updateGPSStatus();
            const dashboardSection = getElement('dashboardSection');
            if (dashboardSection) dashboardSection.style.display = 'block';
            
            if (appActivated) {
                enableFullAccess();
            } else {
                enableReadOnlyMode();
            }
        }
    }
    
    // If app is already activated, show full access
    if (appActivated) {
        enableFullAccess();
    }
    
    // Initialize features
    initializeAppFeatures();
}

// =============================================
// MAKE ALL FUNCTIONS GLOBALLY AVAILABLE
// =============================================

window.captureGPS = captureGPS;
window.showActivationModal = showActivationModal;
window.closeActivationModal = closeActivationModal;
window.activateApp = activateApp;
window.showSection = showSection;
window.addProduct = addProduct;
window.removeProduct = removeProduct;
window.addIncome = addIncome;
window.addExpense = addExpense;
window.showCropDetails = showCropDetails;
window.plantCrop = plantCrop;
window.harvestCrop = harvestCrop;
window.createTask = createTask;
window.completeTask = completeTask;
window.addClient = addClient;
window.contactClient = contactClient;
window.editClient = editClient;
window.removeClient = removeClient;
window.showReport = showReport;
window.printReport = printReport;
window.exportReport = exportReport;
window.changeQuantity = changeQuantity;
window.removeFromCart = removeFromCart;
window.clearCart = clearCart;
window.completeSale = completeSale;
// =============================================
// MAKE ALL FUNCTIONS GLOBALLY AVAILABLE
// =============================================

window.captureGPS = captureGPS;
window.showActivationModal = showActivationModal;
window.closeActivationModal = closeActivationModal;
window.activateApp = activateApp;
window.showSection = showSection;
window.addProduct = addProduct;
window.removeProduct = removeProduct;
window.addIncome = addIncome;
window.addExpense = addExpense;
window.showCropDetails = showCropDetails;
window.plantCrop = plantCrop;
window.harvestCrop = harvestCrop;
window.createTask = createTask;
window.completeTask = completeTask;
window.addClient = addClient;
window.contactClient = contactClient;
window.editClient = editClient;
window.removeClient = removeClient;
window.showReport = showReport;
window.printReport = printReport;
window.exportReport = exportReport;
window.changeQuantity = changeQuantity;
window.removeFromCart = removeFromCart;
window.clearCart = clearCart;
window.completeSale = completeSale;
// Make functions globally available
window.showCropDetails = showCropDetails;
window.filterCrops = filterCrops;
window.filterByType = filterByType;
window.filterByWater = filterByWater;
window.filterBySeason = filterBySeason;
window.clearFilters = clearFilters;
window.showEnhancedCropDetails = showEnhancedCropDetails;
window.closeEnhancedCropModal = closeEnhancedCropModal;
window.setReportPeriod = setReportPeriod;
window.generateCustomReport = generateCustomReport;
window.exportReport = exportReport;
window.printReport = printReport;
window.scheduleReport = scheduleReport;
window.closeScheduleModal = closeScheduleModal;
window.saveSchedule = saveSchedule;

// ADD THESE NEW FUNCTIONS:
window.saveFarmName = saveFarmName;
window.shareFarmViaWhatsApp = shareFarmViaWhatsApp;
window.viewOnGoogleMaps = viewOnGoogleMaps;
// Initialize the app
initializeApp();

// Debug function to check data
window.debugData = function() {
    console.log('Current farmData:', farmData);
    console.log('LocalStorage data:', localStorage.getItem('fa_data'));
    alert('Check console for debug data');
};

}); // End of DOMContentLoaded
</script>

</body>
</html>
